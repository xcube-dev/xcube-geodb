<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Client usage - xcube geoDB</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Client usage";
        var mkdocs_page_input_path = "client_usage.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> xcube geoDB
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Client usage</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodbcoregeodbgeodbclient">xcube_geodb.core.geodb.GeoDBClient</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient">GeoDBClient</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.auth_access_token">auth_access_token</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.capabilities">capabilities</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.database">database</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.raise_it">raise_it</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.server_url">server_url</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.whoami">whoami</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.add_properties">add_properties</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.add_property">add_property</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.add_user_to_group">add_user_to_group</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.collection_exists">collection_exists</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.copy_collection">copy_collection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.count_collection_by_bbox">count_collection_by_bbox</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.count_collection_rows">count_collection_rows</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.create_collection">create_collection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.create_collection_if_not_exists">create_collection_if_not_exists</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.create_collections">create_collections</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.create_collections_if_not_exist">create_collections_if_not_exist</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.create_database">create_database</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.create_group">create_group</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.create_index">create_index</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.database_exists">database_exists</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.delete_from_collection">delete_from_collection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.drop_collection">drop_collection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.drop_collections">drop_collections</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.drop_properties">drop_properties</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.drop_property">drop_property</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_access_rights">get_access_rights</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_all_published_gs">get_all_published_gs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_collection">get_collection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_collection_bbox">get_collection_bbox</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_collection_by_bbox">get_collection_by_bbox</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_collection_info">get_collection_info</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_collection_pg">get_collection_pg</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_collection_srid">get_collection_srid</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_event_log">get_event_log</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_geometry_types">get_geometry_types</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_group_users">get_group_users</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_my_collections">get_my_collections</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_my_databases">get_my_databases</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_my_groups">get_my_groups</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_my_usage">get_my_usage</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_properties">get_properties</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.get_published_gs">get_published_gs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.grant_access_to_collection">grant_access_to_collection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.head_collection">head_collection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.insert_into_collection">insert_into_collection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.list_my_grants">list_my_grants</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.move_collection">move_collection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.publish_collection">publish_collection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.publish_collection_to_group">publish_collection_to_group</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.publish_database_to_group">publish_database_to_group</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.publish_gs">publish_gs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.refresh_auth_access_token">refresh_auth_access_token</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.refresh_config_from_env">refresh_config_from_env</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.remove_index">remove_index</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.remove_user_from_group">remove_user_from_group</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.rename_collection">rename_collection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.revoke_access_from_collection">revoke_access_from_collection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.setup">setup</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.show_indexes">show_indexes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.transform_bbox_crs">transform_bbox_crs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.truncate_database">truncate_database</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.unpublish_collection">unpublish_collection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.unpublish_collection_from_group">unpublish_collection_from_group</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.unpublish_database_from_group">unpublish_database_from_group</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.unpublish_gs">unpublish_gs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#xcube_geodb.core.geodb.GeoDBClient.update_collection">update_collection</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Demo notebooks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../source/notebooks/geodb_explore_collections/">Exploring Data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../source/notebooks/geodb_manage_collections/">Manage collections</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../source/notebooks/geodb_share_collections/">Share geoDB Collections</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../source/notebooks/geodb_group_management/">geoDB user groups</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../source/notebooks/geodb_index_management/">Index management</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../source/notebooks/geodb_geoservice/">Publish your Collection using the EDC / BC Geoservice</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../source/notebooks/geodb_eurocrops_demo/">Demonstration of Eurocrops data use in geoDB</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">xcube geoDB</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Client usage</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="client-api">Client API</h1>
<h2 id="xcube_geodbcoregeodbgeodbclient">xcube_geodb.core.geodb.GeoDBClient</h2>


<div class="doc doc-object doc-class">



<a id="xcube_geodb.core.geodb.GeoDBClient"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


        <p>Constructing the geoDB client. Depending on the setup it will automatically setup credentials from
environment variables. The user can also pass credentials into the constructor.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>server_url</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The URL of the PostGrest Rest API service</p>
              </div>
            </li>
            <li>
              <b><code>server_port</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The port to the PostGrest Rest API service</p>
              </div>
            </li>
            <li>
              <b><code>dotenv_file</code></b>
                  (<code>str</code>, default:
                      <code>&#39;.env&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Name of the dotenv file [.env] to set client IDs and secrets</p>
              </div>
            </li>
            <li>
              <b><code>client_secret</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Client secret (overrides environment variables)</p>
              </div>
            </li>
            <li>
              <b><code>client_id</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Client ID (overrides environment variables)</p>
              </div>
            </li>
            <li>
              <b><code>auth_mode</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Authentication mode [silent]. Can be the oauth2 modes 'client-credentials', 'password',</p>
              </div>
            </li>
            <li>
              <b><code>auth_aud</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Authentication audience</p>
              </div>
            </li>
            <li>
              <b><code>config_file</code></b>
                  (<code>str</code>, default:
                      <code>str(<span title="pathlib.Path.home">home</span>()) + &#39;/.geodb&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Filename that stores config info for the geodb client</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="xcube_geodb.core.geodb.GeoDBError">GeoDBError</span></code>
              –
              <div class="doc-md-description">
                <p>if the auth mode does not exist</p>
              </div>
            </li>
            <li>
                  <code>NotImplementedError</code>
              –
              <div class="doc-md-description">
                <p>on auth mode interactive</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">(</span><span class="n">auth_mode</span><span class="o">=</span><span class="s1">&#39;client-credentials&#39;</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="s1">&#39;***&#39;</span><span class="p">,</span> <span class="n">client_secret</span><span class="o">=</span><span class="s1">&#39;***&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">whoami</span>
<span class="go">my_user</span>
</code></pre></div>






              <details class="quote">
                <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span>
<span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span>
<span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span>
<span class="normal">2475</span>
<span class="normal">2476</span>
<span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span>
<span class="normal">2501</span>
<span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span>
<span class="normal">2519</span>
<span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span>
<span class="normal">2550</span>
<span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span>
<span class="normal">2577</span>
<span class="normal">2578</span>
<span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span>
<span class="normal">2598</span>
<span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span>
<span class="normal">2603</span>
<span class="normal">2604</span>
<span class="normal">2605</span>
<span class="normal">2606</span>
<span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span>
<span class="normal">2616</span>
<span class="normal">2617</span>
<span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span>
<span class="normal">2627</span>
<span class="normal">2628</span>
<span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span>
<span class="normal">2637</span>
<span class="normal">2638</span>
<span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span>
<span class="normal">2647</span>
<span class="normal">2648</span>
<span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span>
<span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span>
<span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span>
<span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span>
<span class="normal">2736</span>
<span class="normal">2737</span>
<span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span>
<span class="normal">2751</span>
<span class="normal">2752</span>
<span class="normal">2753</span>
<span class="normal">2754</span>
<span class="normal">2755</span>
<span class="normal">2756</span>
<span class="normal">2757</span>
<span class="normal">2758</span>
<span class="normal">2759</span>
<span class="normal">2760</span>
<span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span>
<span class="normal">2766</span>
<span class="normal">2767</span>
<span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span>
<span class="normal">2774</span>
<span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span>
<span class="normal">2790</span>
<span class="normal">2791</span>
<span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span>
<span class="normal">2805</span>
<span class="normal">2806</span>
<span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span>
<span class="normal">2811</span>
<span class="normal">2812</span>
<span class="normal">2813</span>
<span class="normal">2814</span>
<span class="normal">2815</span>
<span class="normal">2816</span>
<span class="normal">2817</span>
<span class="normal">2818</span>
<span class="normal">2819</span>
<span class="normal">2820</span>
<span class="normal">2821</span>
<span class="normal">2822</span>
<span class="normal">2823</span>
<span class="normal">2824</span>
<span class="normal">2825</span>
<span class="normal">2826</span>
<span class="normal">2827</span>
<span class="normal">2828</span>
<span class="normal">2829</span>
<span class="normal">2830</span>
<span class="normal">2831</span>
<span class="normal">2832</span>
<span class="normal">2833</span>
<span class="normal">2834</span>
<span class="normal">2835</span>
<span class="normal">2836</span>
<span class="normal">2837</span>
<span class="normal">2838</span>
<span class="normal">2839</span>
<span class="normal">2840</span>
<span class="normal">2841</span>
<span class="normal">2842</span>
<span class="normal">2843</span>
<span class="normal">2844</span>
<span class="normal">2845</span>
<span class="normal">2846</span>
<span class="normal">2847</span>
<span class="normal">2848</span>
<span class="normal">2849</span>
<span class="normal">2850</span>
<span class="normal">2851</span>
<span class="normal">2852</span>
<span class="normal">2853</span>
<span class="normal">2854</span>
<span class="normal">2855</span>
<span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span>
<span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span>
<span class="normal">2873</span>
<span class="normal">2874</span>
<span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span>
<span class="normal">2884</span>
<span class="normal">2885</span>
<span class="normal">2886</span>
<span class="normal">2887</span>
<span class="normal">2888</span>
<span class="normal">2889</span>
<span class="normal">2890</span>
<span class="normal">2891</span>
<span class="normal">2892</span>
<span class="normal">2893</span>
<span class="normal">2894</span>
<span class="normal">2895</span>
<span class="normal">2896</span>
<span class="normal">2897</span>
<span class="normal">2898</span>
<span class="normal">2899</span>
<span class="normal">2900</span>
<span class="normal">2901</span>
<span class="normal">2902</span>
<span class="normal">2903</span>
<span class="normal">2904</span>
<span class="normal">2905</span>
<span class="normal">2906</span>
<span class="normal">2907</span>
<span class="normal">2908</span>
<span class="normal">2909</span>
<span class="normal">2910</span>
<span class="normal">2911</span>
<span class="normal">2912</span>
<span class="normal">2913</span>
<span class="normal">2914</span>
<span class="normal">2915</span>
<span class="normal">2916</span>
<span class="normal">2917</span>
<span class="normal">2918</span>
<span class="normal">2919</span>
<span class="normal">2920</span>
<span class="normal">2921</span>
<span class="normal">2922</span>
<span class="normal">2923</span>
<span class="normal">2924</span>
<span class="normal">2925</span>
<span class="normal">2926</span>
<span class="normal">2927</span>
<span class="normal">2928</span>
<span class="normal">2929</span>
<span class="normal">2930</span>
<span class="normal">2931</span>
<span class="normal">2932</span>
<span class="normal">2933</span>
<span class="normal">2934</span>
<span class="normal">2935</span>
<span class="normal">2936</span>
<span class="normal">2937</span>
<span class="normal">2938</span>
<span class="normal">2939</span>
<span class="normal">2940</span>
<span class="normal">2941</span>
<span class="normal">2942</span>
<span class="normal">2943</span>
<span class="normal">2944</span>
<span class="normal">2945</span>
<span class="normal">2946</span>
<span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span>
<span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span>
<span class="normal">2974</span>
<span class="normal">2975</span>
<span class="normal">2976</span>
<span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span>
<span class="normal">3001</span>
<span class="normal">3002</span>
<span class="normal">3003</span>
<span class="normal">3004</span>
<span class="normal">3005</span>
<span class="normal">3006</span>
<span class="normal">3007</span>
<span class="normal">3008</span>
<span class="normal">3009</span>
<span class="normal">3010</span>
<span class="normal">3011</span>
<span class="normal">3012</span>
<span class="normal">3013</span>
<span class="normal">3014</span>
<span class="normal">3015</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GeoDBClient</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructing the geoDB client. Depending on the setup it will automatically setup credentials from</span>
<span class="sd">    environment variables. The user can also pass credentials into the constructor.</span>

<span class="sd">    Args:</span>
<span class="sd">        server_url (str): The URL of the PostGrest Rest API service</span>
<span class="sd">        server_port (str): The port to the PostGrest Rest API service</span>
<span class="sd">        dotenv_file (str): Name of the dotenv file [.env] to set client IDs and secrets</span>
<span class="sd">        client_secret (str): Client secret (overrides environment variables)</span>
<span class="sd">        client_id (str): Client ID (overrides environment variables)</span>
<span class="sd">        auth_mode (str): Authentication mode [silent]. Can be the oauth2 modes &#39;client-credentials&#39;, &#39;password&#39;,</span>
<span class="sd">        &#39;interactive&#39; and &#39;none&#39; for no authentication</span>
<span class="sd">        auth_aud (str): Authentication audience</span>
<span class="sd">        config_file (str): Filename that stores config info for the geodb client</span>

<span class="sd">    Raises:</span>
<span class="sd">        GeoDBError: if the auth mode does not exist</span>
<span class="sd">        NotImplementedError: on auth mode interactive</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient(auth_mode=&#39;client-credentials&#39;, client_id=&#39;***&#39;, client_secret=&#39;***&#39;)</span>
<span class="sd">        &gt;&gt;&gt; geodb.whoami</span>
<span class="sd">        my_user</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">version</span> <span class="o">=</span> <span class="n">version</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">server_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">server_port</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">client_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">password</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">access_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dotenv_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.env&quot;</span><span class="p">,</span>
        <span class="n">auth_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">auth_domain</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">auth_aud</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;/.geodb&quot;</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">access_token_uri</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">gs_server_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">gs_server_port</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">raise_it</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_use_auth_cache</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dotenv_file</span> <span class="o">=</span> <span class="n">dotenv_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_database</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_it</span> <span class="o">=</span> <span class="n">raise_it</span>
        <span class="c1"># Access token is set here or on request</span>

        <span class="c1"># defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server_url</span> <span class="o">=</span> <span class="n">GEODB_DEFAULTS</span><span class="p">[</span><span class="s2">&quot;server_url&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server_port</span> <span class="o">=</span> <span class="n">GEODB_DEFAULTS</span><span class="p">[</span><span class="s2">&quot;server_port&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_port</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_id</span> <span class="o">=</span> <span class="n">GEODB_DEFAULTS</span><span class="p">[</span><span class="s2">&quot;auth_client_id&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_secret</span> <span class="o">=</span> <span class="n">GEODB_DEFAULTS</span><span class="p">[</span><span class="s2">&quot;auth_client_secret&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_access_token</span> <span class="o">=</span> <span class="n">GEODB_DEFAULTS</span><span class="p">[</span><span class="s2">&quot;auth_access_token&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_domain</span> <span class="o">=</span> <span class="n">GEODB_DEFAULTS</span><span class="p">[</span><span class="s2">&quot;auth_domain&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_aud</span> <span class="o">=</span> <span class="n">GEODB_DEFAULTS</span><span class="p">[</span><span class="s2">&quot;auth_aud&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_mode</span> <span class="o">=</span> <span class="n">GEODB_DEFAULTS</span><span class="p">[</span><span class="s2">&quot;auth_mode&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_username</span> <span class="o">=</span> <span class="n">GEODB_DEFAULTS</span><span class="p">[</span><span class="s2">&quot;auth_username&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_password</span> <span class="o">=</span> <span class="n">GEODB_DEFAULTS</span><span class="p">[</span><span class="s2">&quot;auth_password&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_access_token_uri</span> <span class="o">=</span> <span class="n">GEODB_DEFAULTS</span><span class="p">[</span><span class="s2">&quot;auth_access_token_uri&quot;</span><span class="p">]</span>
        <span class="c1"># override defaults by .env</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_config_from_env</span><span class="p">(</span><span class="n">dotenv_file</span><span class="o">=</span><span class="n">dotenv_file</span><span class="p">,</span> <span class="n">use_dotenv</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># override defaults and .env if given in constructor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server_url</span> <span class="o">=</span> <span class="n">server_url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_url</span> <span class="o">=</span> <span class="n">gs_server_url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_port</span> <span class="o">=</span> <span class="n">gs_server_port</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server_port</span> <span class="o">=</span> <span class="n">server_port</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_id</span> <span class="o">=</span> <span class="n">client_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_secret</span> <span class="o">=</span> <span class="n">client_secret</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_secret</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_username</span> <span class="o">=</span> <span class="n">username</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_password</span> <span class="o">=</span> <span class="n">password</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_mode</span> <span class="o">=</span> <span class="n">auth_mode</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_aud</span> <span class="o">=</span> <span class="n">auth_aud</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_aud</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_domain</span> <span class="o">=</span> <span class="n">auth_domain</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_domain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_access_token</span> <span class="o">=</span> <span class="n">access_token</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_access_token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_access_token_uri</span> <span class="o">=</span> <span class="n">access_token_uri</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_access_token_uri</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_database</span> <span class="o">=</span> <span class="n">database</span>

        <span class="c1"># Set geoserver hosts to geodb host if still unset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_port</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_port</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_whoami</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ipython_shell</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mandatory_properties</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">,</span> <span class="s2">&quot;modified_at&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_config_file</span> <span class="o">=</span> <span class="n">config_file</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="s2">&quot;interactive&quot;</span><span class="p">,</span>
            <span class="s2">&quot;password&quot;</span><span class="p">,</span>
            <span class="s2">&quot;client-credentials&quot;</span><span class="p">,</span>
            <span class="s2">&quot;openid&quot;</span><span class="p">,</span>
            <span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span>
                <span class="s2">&quot;auth_mode can only be &#39;interactive&#39;, &#39;password&#39;, &quot;</span>
                <span class="s2">&quot;&#39;client-credentials&#39;, or &#39;openid&#39;!&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_mode</span> <span class="o">==</span> <span class="s2">&quot;interactive&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The interactive mode has not been implemented.&quot;</span><span class="p">)</span>
            <span class="c1"># self._auth_login()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_from_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load configurations from environment variables. Overrides defaults.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_API_SERVER_URL&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server_port</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_API_SERVER_PORT&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEOSERVER_SERVER_URL&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_port</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEOSERVER_SERVER_PORT&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_port</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_AUTH_CLIENT_ID&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_secret</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_AUTH_CLIENT_SECRET&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_secret</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_access_token</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_AUTH_ACCESS_TOKEN&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_access_token</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_domain</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_AUTH_DOMAIN&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_domain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_aud</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_AUTH_AUD&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_aud</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_mode</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_AUTH_MODE&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_username</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_AUTH_USERNAME&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_AUTH_PASSWORD&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_access_token_uri</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_AUTH_ACCESS_TOKEN_URI&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_access_token_uri</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_database</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_DATABASE&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_collection_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The name of the collection to inspect</span>
<span class="sd">            database (str): The database the collection resides in [current</span>
<span class="sd">            database]</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary with collection information</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError: When the collection does not exist</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient(auth_mode=&#39;client-credentials&#39;, client_id=&#39;***&#39;, client_secret=&#39;***&#39;)</span>
<span class="sd">            &gt;&gt;&gt; geodb.get_collection_info(&#39;my_collection&#39;)</span>
<span class="sd">            {</span>
<span class="sd">                &#39;required&#39;: [&#39;id&#39;, &#39;geometry&#39;],</span>
<span class="sd">                &#39;properties&#39;: {</span>
<span class="sd">                &#39;id&#39;: {</span>
<span class="sd">                    &#39;format&#39;: &#39;integer&#39;, &#39;type&#39;: &#39;integer&#39;,</span>
<span class="sd">                    &#39;description&#39;: &#39;Note:This is a Primary Key.&#39;</span>
<span class="sd">                },</span>
<span class="sd">                &#39;created_at&#39;: {&#39;format&#39;: &#39;timestamp with time zone&#39;, &#39;type&#39;: &#39;string&#39;},</span>
<span class="sd">                &#39;modified_at&#39;: {&#39;format&#39;: &#39;timestamp with time zone&#39;, &#39;type&#39;: &#39;string&#39;},</span>
<span class="sd">                &#39;geometry&#39;: {&#39;format&#39;: &#39;public.geometry(Geometry,3794)&#39;, &#39;type&#39;: &#39;string&#39;},</span>
<span class="sd">                &#39;my_property1&#39;: {&#39;format&#39;: &#39;double precision&#39;, &#39;type&#39;: &#39;number&#39;},</span>
<span class="sd">                &#39;my_property2&#39;: {&#39;format&#39;: &#39;double precision&#39;, &#39;type&#39;: &#39;number&#39;},</span>
<span class="sd">                &#39;type&#39;: &#39;object&#39;</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">capabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

        <span class="n">collection</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

        <span class="k">if</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">capabilities</span><span class="p">[</span><span class="s2">&quot;definitions&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">capabilities</span><span class="p">[</span><span class="s2">&quot;definitions&quot;</span><span class="p">][</span><span class="n">collection</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">GeoDBError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_collection_bbox</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exact</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the bounding box for the collection, i.e. the union of all</span>
<span class="sd">        rows&#39; geometries.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The name of the collection to return the</span>
<span class="sd">             bounding box for.</span>
<span class="sd">            database (str): The database the collection resides in. Default:</span>
<span class="sd">             current database.</span>
<span class="sd">            exact (bool): If the exact bbox shall be computed. Warning: This</span>
<span class="sd">             may take much longer. Default: False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the bounding box given as tuple xmin, ymin, xmax, ymax or None if</span>
<span class="sd">            collection is empty</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient(auth_mode=&#39;client-credentials&#39;, \</span>
<span class="sd">                                    client_id=&#39;***&#39;,</span>
<span class="sd">                                    client_secret=&#39;***&#39;)</span>
<span class="sd">            &gt;&gt;&gt; geodb.get_collection_bbox(&#39;my_collection&#39;)</span>
<span class="sd">            (-5, 10, 5, 11)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">ast</span><span class="w"> </span><span class="kn">import</span> <span class="n">literal_eval</span>

            <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
            <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">if</span> <span class="n">exact</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_get_collection_bbox&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">}</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_estimate_collection_bbox&quot;</span><span class="p">,</span>
                    <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;BOX&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">bbox</span> <span class="o">==</span> <span class="s2">&quot;null&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">literal_eval</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_geometry_types</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">aggregate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the geometry types of the given collection, either as an</span>
<span class="sd">        extensive list of the geometry types for each collection entry, or</span>
<span class="sd">        as aggregated list of the types that appear in the collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str):  The collection to list geometry types for</span>
<span class="sd">            aggregate (bool):  If the result shall be an aggregated list, default is set to &quot;True&quot;</span>
<span class="sd">            database (str):    The database that contains the collection</span>
<span class="sd">        Returns:</span>
<span class="sd">            List[str]: A list of the geometry types, either for each</span>
<span class="sd">                       collection entry or aggregated.</span>
<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError: If the database raises an error</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span>
            <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span> <span class="s2">&quot;aggregate&quot;</span><span class="p">:</span> <span class="s2">&quot;TRUE&quot;</span> <span class="k">if</span> <span class="n">aggregate</span> <span class="k">else</span> <span class="s2">&quot;FALSE&quot;</span><span class="p">}</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_geometry_types&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
            <span class="n">types</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;types&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;geometrytype&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">types</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_my_collections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            database (str): The database to list collections from</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Dataframe of collection names</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient(auth_mode=&#39;client-credentials&#39;, client_id=&#39;***&#39;, client_secret=&#39;***&#39;)</span>
<span class="sd">            &gt;&gt;&gt; geodb.get_my_collections()</span>
<span class="sd">                owner	                        database	                    collection</span>
<span class="sd">            0	geodb_9bfgsdfg-453f-445b-a459	geodb_9bfgsdfg-453f-445b-a459	land_use</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="n">database</span><span class="p">}</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_get_my_collections&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
            <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;src&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_from_json</span><span class="p">(</span><span class="n">js</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;collection&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_common_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_mode</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;Prefer&quot;</span><span class="p">:</span> <span class="s2">&quot;return=representation&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;Prefer&quot;</span><span class="p">:</span> <span class="s2">&quot;return=representation&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_access_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">raise_it</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns:</span>
<span class="sd">            The current error message behaviour</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raise_it</span>

    <span class="nd">@raise_it</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">raise_it</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_it</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">database</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns:</span>
<span class="sd">            The current database</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">whoami</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">whoami</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns:</span>
<span class="sd">            The current database user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_whoami</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_whoami&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary of the geoDB PostGrest REST API service&#39;s capabilities</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_refresh_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capabilities</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_geodb_sql_version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_get_geodb_sql_version&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_config_from_env</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dotenv_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.env&quot;</span><span class="p">,</span> <span class="n">use_dotenv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refresh the configuration from environment variables. The variables can be preset by a dotenv file.</span>
<span class="sd">        Args:</span>
<span class="sd">            dotenv_file (str): A dotenv config file</span>
<span class="sd">            use_dotenv (bool): Whether to use GEODB_AUTH_CLIENT_ID a dotenv file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">use_dotenv</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dotenv_file</span> <span class="o">=</span> <span class="n">find_dotenv</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">dotenv_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dotenv_file</span><span class="p">:</span>
                <span class="n">load_dotenv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dotenv_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_from_env</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_post</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">],</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">headers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">raise_for_status</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            headers [Optional[Dict]]: Request headers. Allows Overriding common header entries.</span>
<span class="sd">            path (str): API path</span>
<span class="sd">            payload (Union[Dict, Sequence]): Post body as Dict or Sequence. Will be dumped to JSON</span>
<span class="sd">            params Optional[Dict]: Request parameters</span>
<span class="sd">            raise_for_status (bool): raise or not if status is not 200-299 [True]</span>
<span class="sd">        Returns:</span>
<span class="sd">            requests.models.Response: A Request object</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError: If the database raises an error</span>
<span class="sd">            HttpError: If the request fails</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">common_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_common_headers</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">headers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">common_headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">common_headers</span><span class="p">[</span><span class="s2">&quot;Content-type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;text/csv&quot;</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_get_full_url</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">),</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                    <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="n">common_headers</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_get_full_url</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">),</span>
                    <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                    <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="n">common_headers</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">raise_for_status</span><span class="p">:</span>
                <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): API path</span>
<span class="sd">            params (Optional[Dict]): Request parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            requests.models.Response: A Response object</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError: If the database raises an error</span>
<span class="sd">            HttpError: If the request fails</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">r</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_full_url</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">),</span>
                <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_common_headers</span><span class="p">()),</span>
            <span class="p">)</span>
            <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_delete</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">headers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            headers (Optional[Dict]): Request headers. Allows Overriding common header entries.</span>
<span class="sd">            path (str): API path</span>
<span class="sd">            params (Optional[Dict]): Request parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            requests.models.Response: A Request object</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError: If the database raises an error</span>
<span class="sd">            HttpError: If the request fails</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">common_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_common_headers</span><span class="p">()</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">common_headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span> <span class="k">if</span> <span class="n">headers</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_common_headers</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_full_url</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">),</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span>
            <span class="p">)</span>
            <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_patch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">],</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">headers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            headers (Optional[Dict]): Request headers. Allows Overriding common header entries.</span>
<span class="sd">            payload (Union[Dict, Sequence]): Post body as Dict. Will be dumped to JSON</span>
<span class="sd">            path (str): API path</span>
<span class="sd">            params (Optional[Dict]): Request parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            requests.models.Response: A Request object</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError: If the database raises an error</span>
<span class="sd">            HttpError: If the request fails</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">common_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_common_headers</span><span class="p">()</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">common_headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span> <span class="k">if</span> <span class="n">headers</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_common_headers</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_full_url</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">),</span>
                <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_put</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">],</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">headers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            headers (Optional[Dict]): Request headers. Allows Overriding common header entries.</span>
<span class="sd">            payload (Union[Dict, Sequence]): Post body as Dict. Will be dumped to JSON</span>
<span class="sd">            path (str): API path</span>
<span class="sd">            params (Optional[Dict]): Request parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            requests.models.Response: A Request object</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError: If the database raises an error</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">common_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_common_headers</span><span class="p">()</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">common_headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span> <span class="k">if</span> <span class="n">headers</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_common_headers</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_full_url</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">),</span>
                <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">r</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_maybe_raise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raise_it</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_df</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;Error&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="n">msg</span><span class="p">,</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_my_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">Message</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get my geoDB data usage.</span>

<span class="sd">        Args:</span>
<span class="sd">            pretty (bool): Whether to return in human readable form or in bytes</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dict containing the usage in bytes (int) or as a human readable string</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.get_my_usage(True)</span>
<span class="sd">            {&#39;usage&#39;: &#39;6432 kB&#39;}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pretty&quot;</span><span class="p">:</span> <span class="n">pretty</span><span class="p">}</span> <span class="k">if</span> <span class="n">pretty</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_get_my_usage&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;src&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_collection_if_not_exists</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">crs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4326</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">Message</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a collection only if the collection does not exist already.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The name of the collection to be created</span>
<span class="sd">            properties (Dict): Properties to be added to the collection</span>
<span class="sd">            crs (int, str): projection</span>
<span class="sd">            database (str): The database the collection is to be created in [current database]</span>
<span class="sd">            kwargs: Placeholder for deprecated parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            Collection:  Collection info id operation succeeds</span>
<span class="sd">            None: If operation fails</span>

<span class="sd">        Examples:</span>
<span class="sd">            See create_collection for an example</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_exists</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                    <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
                    <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
                    <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
                    <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_collections_if_not_exist</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collections</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates collections only if collections do not exist already.</span>

<span class="sd">        Args:</span>
<span class="sd">            collections (Dict): The name of the collection to be created</span>
<span class="sd">            database (str): The database the collection is to be created in [current database]</span>
<span class="sd">            kwargs: Placeholder for deprecated parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of Collections: List of informations about created collections</span>

<span class="sd">        Examples:</span>
<span class="sd">            See create_collections for examples</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">:</span>
            <span class="n">exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_exists</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">exists</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="n">collection</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="p">[</span><span class="n">collection</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_collections</span><span class="p">(</span><span class="n">collections</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_collections</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collections</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">clear</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">Message</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create collections from a dictionary</span>
<span class="sd">        Args:</span>
<span class="sd">            clear (bool): Delete collections prioer to creation</span>
<span class="sd">            collections (Dict): A dictionalry of collections</span>
<span class="sd">            database (str): Database to use for creating the collection</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Success</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; collections = {&#39;[MyCollection]&#39;: {&#39;crs&#39;: 1234, &#39;properties&#39;: \</span>
<span class="sd">                    {&#39;[MyProp1]&#39;: &#39;float&#39;, &#39;[MyProp2]&#39;: &#39;date&#39;}}}</span>
<span class="sd">            &gt;&gt;&gt; geodb.create_collections(collections)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;crs&quot;</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">[</span><span class="n">collection</span><span class="p">]:</span>
                <span class="n">collections</span><span class="p">[</span><span class="n">collection</span><span class="p">][</span><span class="s2">&quot;crs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">check_crs</span><span class="p">(</span>
                    <span class="n">collections</span><span class="p">[</span><span class="n">collection</span><span class="p">][</span><span class="s2">&quot;crs&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">drop_collection</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">GeoDBError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_capabilities</span><span class="p">()</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_exists</span><span class="p">(</span><span class="n">database</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="s2">&quot;Database does not exist.&quot;</span><span class="p">)</span>

        <span class="n">buffer</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">:</span>
            <span class="n">buffer</span><span class="p">[</span><span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="p">[</span><span class="n">collection</span><span class="p">]</span>

        <span class="n">collections</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;collections&quot;</span><span class="p">:</span> <span class="n">buffer</span><span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_create_collections&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">collections</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">[</span><span class="s2">&quot;collections&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">CREATED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="n">collections</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">crs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4326</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">clear</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create collections from a dictionary</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): Name of the collection to be created</span>
<span class="sd">            clear (bool): Whether to delete existing collections</span>
<span class="sd">            properties (Dict): Property definitions for the collection</span>
<span class="sd">            database (str): Database to use for creating the collection</span>
<span class="sd">            crs: sfdv</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Success</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; properties = {&#39;[MyProp1]&#39;: &#39;float&#39;, &#39;[MyProp2]&#39;: &#39;date&#39;}</span>
<span class="sd">            &gt;&gt;&gt; geodb.create_collection(collection=&#39;[MyCollection]&#39;, crs=3794, properties=properties)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">crs</span> <span class="o">=</span> <span class="n">check_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
        <span class="n">collections</span> <span class="o">=</span> <span class="p">{</span><span class="n">collection</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span><span class="p">,</span> <span class="s2">&quot;crs&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">crs</span><span class="p">)}}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_capabilities</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_collections</span><span class="p">(</span>
            <span class="n">collections</span><span class="o">=</span><span class="n">collections</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="n">clear</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">drop_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): Name of the collection to be dropped</span>
<span class="sd">            database (str): The database the colections resides in [current database]</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Success</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.drop_collection(collection=&#39;[MyCollection]&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_collections</span><span class="p">(</span>
            <span class="n">collections</span><span class="o">=</span><span class="p">[</span><span class="n">collection</span><span class="p">],</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> <span class="n">cascade</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">drop_collections</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collections</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">cascade</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            database (str): The database the colections resides in [current database]</span>
<span class="sd">            collections (Sequence[str]): Collections to be dropped</span>
<span class="sd">            cascade (bool): Drop in cascade mode. This can be necessary if e.g. sequences have not been</span>
<span class="sd">                            deleted properly</span>

<span class="sd">        Returns:</span>
<span class="sd">            Message</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.drop_collections(collections=[&#39;[MyCollection1]&#39;, &#39;[MyCollection2]&#39;])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_capabilities</span><span class="p">()</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">collections</span> <span class="o">=</span> <span class="p">[</span><span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span> <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">]</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;collections&quot;</span><span class="p">:</span> <span class="n">collections</span><span class="p">,</span>
            <span class="s2">&quot;cascade&quot;</span><span class="p">:</span> <span class="s2">&quot;TRUE&quot;</span> <span class="k">if</span> <span class="n">cascade</span> <span class="k">else</span> <span class="s2">&quot;FALSE&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_drop_collections&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">DROPPED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">collections</span><span class="p">)</span><span class="si">}</span><span class="s2"> deleted&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">grant_access_to_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">usr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): Collection name to grant access to</span>
<span class="sd">            usr (str): Username to grant access to</span>
<span class="sd">            database (str): The database the collection resides in</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Success</span>

<span class="sd">        Raises:</span>
<span class="sd">            HttpError: when http request fails</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.grant_access_to_collection(&#39;[Collection]&#39;, &#39;[User who gets access]&#39;)</span>
<span class="sd">            Access granted on Collection to User who gets access}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_grant_access_to_collection&quot;</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span> <span class="s2">&quot;usr&quot;</span><span class="p">:</span> <span class="n">usr</span><span class="p">},</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access granted on </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">usr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rename_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The name of the collection to be renamed</span>
<span class="sd">            new_name (str):The new name of the collection</span>
<span class="sd">            database (str): The database the collection resides in</span>

<span class="sd">        Raises:</span>
<span class="sd">            HttpError: When request fails</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span>

        <span class="n">old_dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">new_dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_name</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_rename_collection&quot;</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">old_dn</span><span class="p">,</span> <span class="s2">&quot;new_name&quot;</span><span class="p">:</span> <span class="n">new_dn</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">RENAMED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">old_dn</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection renamed from </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">move_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_database</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move a collection from one database to another.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The name of the collection to be moved</span>
<span class="sd">            new_database (str): The database the collection will be moved to</span>
<span class="sd">            database (str): The database the collection resides in</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.move_collection(&#39;collection&#39;, &#39;new_database&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span>
        <span class="n">old_dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">new_dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_rename_collection&quot;</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">old_dn</span><span class="p">,</span> <span class="s2">&quot;new_name&quot;</span><span class="p">:</span> <span class="n">new_dn</span><span class="p">},</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">MOVED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">old_dn</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection moved from </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> to &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_database</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">copy_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">new_collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">new_database</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The name of the collection to be copied</span>
<span class="sd">            new_collection (str): The new name of the collection</span>
<span class="sd">            database (str): The database the collection resides in</span>
<span class="sd">                            [current database]</span>
<span class="sd">            new_database (str): The database the collection will be copied to</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.copy_collection(&#39;col&#39;, &#39;col_new&#39;, &#39;target_db&#39;,</span>
<span class="sd">                                      &#39;source_db&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span>
        <span class="n">from_dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">to_dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_collection</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_copy_collection&quot;</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;old_collection&quot;</span><span class="p">:</span> <span class="n">from_dn</span><span class="p">,</span> <span class="s2">&quot;new_collection&quot;</span><span class="p">:</span> <span class="n">to_dn</span><span class="p">},</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">COPIED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">from_dn</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">to_dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection copied from </span><span class="si">{</span><span class="n">from_dn</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">to_dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">publish_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Publish a collection. The collection will be accessible by all users</span>
<span class="sd">        in the geoDB.</span>

<span class="sd">        Args:</span>
<span class="sd">            database (str): The database the collection resides in</span>
<span class="sd">                            [current database]</span>
<span class="sd">            collection (str): The name of the collection that will be made</span>
<span class="sd">                              public</span>

<span class="sd">        Returns:</span>
<span class="sd">            Message: Message whether operation succeeded</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.publish_collection(&#39;[Collection]&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">grant_access_to_collection</span><span class="p">(</span>
                <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">usr</span><span class="o">=</span><span class="s2">&quot;public&quot;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span>
                <span class="n">EventType</span><span class="o">.</span><span class="n">PUBLISHED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access granted on </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> to &quot;</span> <span class="sa">f</span><span class="s2">&quot;public.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">unpublish_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Revoke public access to a collection. The collection will not be</span>
<span class="sd">        accessible by all users in the geoDB.</span>

<span class="sd">        Args:</span>
<span class="sd">            database (str): The database the collection resides in</span>
<span class="sd">            [current database]</span>
<span class="sd">            collection (str): The name of the collection that will be removed</span>
<span class="sd">            from public access</span>

<span class="sd">        Returns:</span>
<span class="sd">            Message: Message whether operation succeeded</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.unpublish_collection(&#39;[Collection]&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">revoke_access_from_collection</span><span class="p">(</span>
                <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">usr</span><span class="o">=</span><span class="s2">&quot;public&quot;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">revoke_access_from_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">usr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Revoke access from a collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): Name of the collection</span>
<span class="sd">            usr (str): User to revoke access from</span>
<span class="sd">            database (str): The database the collection resides in</span>
<span class="sd">                            [current database]</span>

<span class="sd">        Returns:</span>
<span class="sd">            Message: Whether operation has succeeded</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_revoke_access_from_collection&quot;</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span> <span class="s2">&quot;usr&quot;</span><span class="p">:</span> <span class="n">usr</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">UNPUBLISHED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access revoked from public on </span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_my_grants</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">Message</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List the access grants the current user has granted.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A list of the current user&#39;s access grants</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError: If access to geoDB fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_list_grants&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{})</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="s2">&quot;Body not in valid JSON format: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">js</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">js</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s2">&quot;src&quot;</span> <span class="ow">in</span> <span class="n">js</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">js</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;src&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_from_json</span><span class="p">(</span><span class="n">js</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;src&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Grants&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;No Grants&quot;</span><span class="p">]})</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">GeoDBError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_property</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">typ</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a property to an existing collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The name of the collection to add a property to</span>
<span class="sd">            prop (str): Property name</span>
<span class="sd">            typ (str): The data type of the property (Postgres type)</span>
<span class="sd">            database (str): The database the collection resides in [current</span>
<span class="sd">                            database]</span>

<span class="sd">        Returns:</span>
<span class="sd">            Message: Success message</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.add_property(collection=&#39;[MyCollection]&#39;, \</span>
<span class="sd">                name=&#39;[MyProperty]&#39;, type=&#39;[PostgresType]&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="p">{</span><span class="n">prop</span><span class="p">:</span> <span class="n">typ</span><span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_properties</span><span class="p">(</span>
            <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_properties</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add properties to a collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The name of the collection to add properties to</span>
<span class="sd">            properties (Dict): Property definitions as dictionary</span>
<span class="sd">            database (str): The database the collection resides in [current</span>
<span class="sd">                            database]</span>
<span class="sd">        Returns:</span>
<span class="sd">            Message: Whether the operation succeeded</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; properties = {&#39;[MyName1]&#39;: &#39;[PostgresType1]&#39;, \</span>
<span class="sd">                              &#39;[MyName2]&#39;: &#39;[PostgresType2]&#39;}</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.add_property(collection=&#39;[MyCollection]&#39;, \</span>
<span class="sd">                                   properties=properties)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_capabilities</span><span class="p">()</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_add_properties&quot;</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span> <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">prop_name</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
                <span class="n">prop_type</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="n">prop_name</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span>
                    <span class="n">EventType</span><span class="o">.</span><span class="n">PROPERTY_ADDED</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="s2">name: </span><span class="si">{</span><span class="n">prop_name</span><span class="si">}</span><span class="s2">, &quot;</span> <span class="sa">f</span><span class="s2">&quot;type: </span><span class="si">{</span><span class="n">prop_type</span><span class="si">}</span><span class="se">}}</span><span class="s2"> to collection </span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Properties added&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">drop_property</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drop a property from a collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The name of the collection to drop the property from</span>
<span class="sd">            prop (str): The property to delete</span>
<span class="sd">            database (str): The database the collection resides in [current database]</span>

<span class="sd">        Returns:</span>
<span class="sd">            Message: Whether the operation succeeded</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.drop_property(collection=&#39;[MyCollection]&#39;, \</span>
<span class="sd">                                    prop=&#39;[MyProperty]&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_properties</span><span class="p">(</span>
            <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">[</span><span class="n">prop</span><span class="p">],</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">drop_properties</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drop properties from a collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str):  The name of the collection to delete properties</span>
<span class="sd">                               from</span>
<span class="sd">            properties (List): A list containing the property names</span>
<span class="sd">            database (str):    The database the collection resides in [current</span>
<span class="sd">                               database]</span>
<span class="sd">        Returns:</span>
<span class="sd">            Message: Whether the operation succeeded</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.drop_properties(collection=&#39;MyCollection&#39;, \</span>
<span class="sd">                                      properties=[&#39;MyProperty1&#39;, \</span>
<span class="sd">                                                  &#39;MyProperty2&#39;])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_capabilities</span><span class="p">()</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_mandatory_columns</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_stored_procedure_exists</span><span class="p">(</span><span class="s2">&quot;geodb_drop_properties&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_drop_properties&quot;</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">,</span> <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span>
                    <span class="n">EventType</span><span class="o">.</span><span class="n">PROPERTY_DROPPED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2"> from collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Properties </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span><span class="si">}</span><span class="s2"> dropped from &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_raise_for_mandatory_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="n">common_props</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mandatory_properties</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">common_props</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="s2">&quot;Don&#39;t delete the following columns: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">common_props</span><span class="p">))</span>

    <span class="nd">@deprecated_kwarg</span><span class="p">(</span><span class="s2">&quot;namespace&quot;</span><span class="p">,</span> <span class="s2">&quot;database&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_properties</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of properties of a collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The name of the collection to retrieve a list of properties from</span>
<span class="sd">            database (str): The database the collection resides in [current database]</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A list of properties</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_get_properties&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">}</span>
            <span class="p">)</span>

            <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;src&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_from_json</span><span class="p">(</span><span class="n">js</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;collection&quot;</span><span class="p">,</span> <span class="s2">&quot;column_name&quot;</span><span class="p">,</span> <span class="s2">&quot;data_type&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a database.</span>

<span class="sd">        Args:</span>
<span class="sd">            database (str): The name of the database to be created</span>

<span class="sd">        Returns:</span>
<span class="sd">            Message: A message about the success or failure of the operation</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_create_database&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="n">database</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> created&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">truncate_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete all tables in the given database.</span>

<span class="sd">        Args:</span>
<span class="sd">            database (str): The name of the database to be created</span>

<span class="sd">        Returns:</span>
<span class="sd">            Message: A message about the success or failure of the operation</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_truncate_database&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="n">database</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> truncated&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_my_databases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of databases the current user owns.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A list of databases the user owns</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span>
                <span class="n">collection</span><span class="o">=</span><span class="s2">&quot;user_databases&quot;</span><span class="p">,</span>
                <span class="n">database</span><span class="o">=</span><span class="s2">&quot;geodb&quot;</span><span class="p">,</span>
                <span class="n">query</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;owner=eq.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">database_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether a database exists.</span>

<span class="sd">        Args:</span>
<span class="sd">            database (str): The name of the database to be checked</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: database exists</span>

<span class="sd">        Raises:</span>
<span class="sd">            HttpError: If request fails</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span>
                <span class="n">collection</span><span class="o">=</span><span class="s2">&quot;user_databases&quot;</span><span class="p">,</span>
                <span class="n">database</span><span class="o">=</span><span class="s2">&quot;geodb&quot;</span><span class="p">,</span>
                <span class="n">query</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;name=eq.</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_from_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete rows from collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The name of the collection to delete rows from</span>
<span class="sd">            database (str): The name of the database to be checked</span>
<span class="sd">            query (str): Filter which records to delete. Follow the</span>
<span class="sd">                         https://postgrest.org/en/v6.0/api.html query convention.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Message: Whether the operation has succeeded</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.delete_from_collection(&#39;[MyCollection]&#39;, &#39;id=eq.1&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span>
                <span class="n">EventType</span><span class="o">.</span><span class="n">ROWS_DROPPED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;from collection </span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2"> where </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data from </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> deleted&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="nd">@deprecated_kwarg</span><span class="p">(</span><span class="s2">&quot;namespace&quot;</span><span class="p">,</span> <span class="s2">&quot;database&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update data in a collection by a query.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The name of the collection to be updated</span>
<span class="sd">            database (str): The name of the database to be checked</span>
<span class="sd">            values (Dict): Values to update</span>
<span class="sd">            query (str): Filter which values to be updated. Follow the http://postgrest.org/en/v6.0/api.html query</span>
<span class="sd">            convention.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Message: Success</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError: if the values is not a Dict or request fails</span>
<span class="sd">        Example:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_collection_exists</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">Dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">del</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Format </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="si">}</span><span class="s2"> not supported.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patch</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> updated&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="c1"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_gdf_prepare_geom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gpdf</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">crs</span> <span class="o">=</span> <span class="n">gpdf</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">crs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid crs in geopandas data frame. You can pass the crs as parameter &quot;</span>
                    <span class="s2">&quot;(crs=[your crs])&quot;</span>
                <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">add_srid</span><span class="p">(</span><span class="n">point</span><span class="p">):</span>
            <span class="n">point_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;SRID&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">point_str</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;SRID=</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span><span class="si">}</span><span class="s2">;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

        <span class="n">gpdf2</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">gpdf</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">gpdf2</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpdf2</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">add_srid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gpdf2</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_gdf_to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gpdf</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="n">gpdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gdf_prepare_geom</span><span class="p">(</span><span class="n">gpdf</span><span class="p">,</span> <span class="n">crs</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">gpdf</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">insert_into_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">values</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">,</span>
        <span class="n">upsert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">crs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_transfer_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert data into a collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): Collection to be inserted to</span>
<span class="sd">            database (str): The name of the database the collection resides in</span>
<span class="sd">                            [current database]</span>
<span class="sd">            values (GeoDataFrame): Values to be inserted</span>
<span class="sd">            upsert (bool): Whether the insert shall replace existing rows</span>
<span class="sd">                           (by PK)</span>
<span class="sd">            crs (int, str): crs (in the form of an SRID) of the geometries. If</span>
<span class="sd">                            not present, the method will attempt guessing it</span>
<span class="sd">                            from the GeoDataFrame input. Must be in sync with</span>
<span class="sd">                            the target collection in the GeoDatabase</span>
<span class="sd">            max_transfer_chunk_size (int): Maximum number of rows per chunk to</span>
<span class="sd">                                           be sent to the geodb.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When crs is not given and cannot be guessed from the</span>
<span class="sd">                        GeoDataFrame</span>
<span class="sd">            GeoDBError: If the values are not in format Dict</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Success</span>

<span class="sd">        Example:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">srid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection_srid</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="p">)</span>
        <span class="n">crs</span> <span class="o">=</span> <span class="n">check_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">crs</span> <span class="ow">and</span> <span class="n">srid</span> <span class="ow">and</span> <span class="n">srid</span> <span class="o">!=</span> <span class="n">crs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;crs </span><span class="si">{</span><span class="n">crs</span><span class="si">}</span><span class="s2"> is not compatible with collection&#39;s &quot;</span> <span class="sa">f</span><span class="s2">&quot;crs </span><span class="si">{</span><span class="n">srid</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">crs</span> <span class="o">=</span> <span class="n">crs</span> <span class="ow">or</span> <span class="n">srid</span>
        <span class="n">total_rows</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">GeoDataFrame</span><span class="p">):</span>
            <span class="c1"># headers = {&#39;Content-type&#39;: &#39;text/csv&#39;}</span>
            <span class="c1"># values = self._gdf_prepare_geom(values, crs)</span>
            <span class="n">ct</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">cont</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">total_rows</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">while</span> <span class="n">cont</span><span class="p">:</span>
                <span class="n">frm</span> <span class="o">=</span> <span class="n">ct</span>
                <span class="n">to</span> <span class="o">=</span> <span class="n">ct</span> <span class="o">+</span> <span class="n">max_transfer_chunk_size</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">ngdf</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">frm</span><span class="p">:</span><span class="n">to</span><span class="p">]</span>
                <span class="n">ct</span> <span class="o">+=</span> <span class="n">max_transfer_chunk_size</span>

                <span class="n">nct</span> <span class="o">=</span> <span class="n">ngdf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cont</span> <span class="o">=</span> <span class="n">nct</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">cont</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="k">if</span> <span class="n">nct</span> <span class="o">&lt;</span> <span class="n">max_transfer_chunk_size</span><span class="p">:</span>
                    <span class="n">to</span> <span class="o">=</span> <span class="n">frm</span> <span class="o">+</span> <span class="n">nct</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing rows from </span><span class="si">{</span><span class="n">frm</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">to</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">ngdf</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">upsert</span><span class="p">:</span>
                    <span class="n">ngdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>

                <span class="n">ngdf</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">ngdf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                <span class="n">js</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gdf_to_json</span><span class="p">(</span><span class="n">ngdf</span><span class="p">,</span> <span class="n">crs</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">upsert</span><span class="p">:</span>
                    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Prefer&quot;</span><span class="p">:</span> <span class="s2">&quot;resolution=merge-duplicates&quot;</span><span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">headers</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">js</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;Connection aborted&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="n">e</span>
                    <span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;LineTooLong(&#39;got more than 65536 bytes &quot;</span> <span class="s2">&quot;when reading header line&#39;)&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="n">e</span>
                    <span class="p">):</span>
                        <span class="c1"># ignore this error - the ingestion has worked.</span>
                        <span class="c1"># see https://github.com/dcs4cop/xcube-geodb/issues/60</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span>
                <span class="n">GeoDBError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Format </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="si">}</span><span class="s2"> not &quot;</span> <span class="sa">f</span><span class="s2">&quot;supported.&quot;</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_rows</span><span class="si">}</span><span class="s2"> rows inserted into &quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">ROWS_ADDED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}{</span><span class="n">dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">transform_bbox_crs</span><span class="p">(</span>
        <span class="n">bbox</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">from_crs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">to_crs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">wsg84_order</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;lat_lon&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function can be used to reproject bboxes particularly with the use of GeoDBClient.get_collection_by_bbox.</span>

<span class="sd">        Args:</span>
<span class="sd">            bbox: Tuple[float, float, float, float]: bbox to be reprojected, given as MINX, MINY, MAXX, MAXY</span>
<span class="sd">            from_crs: Source crs e.g. 3974</span>
<span class="sd">            to_crs: Target crs e.g. 4326</span>
<span class="sd">            wsg84_order (str): WSG84 (EPSG:4326) is expected to be in Lat Lon format (&quot;lat_lon&quot;). Use &quot;lon_lat&quot; if</span>
<span class="sd">                               Lon Lat is used.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Tuple[float, float, float, float]: The reprojected bounding box</span>

<span class="sd">        Examples:</span>
<span class="sd">             &gt;&gt;&gt; bbox = GeoDBClient.transform_bbox_crs(bbox=(450000, 100000, 470000, 110000), from_crs=3794, to_crs=4326)</span>
<span class="sd">             &gt;&gt;&gt; bbox</span>
<span class="sd">             (49.36588643725233, 46.012889756941775, 14.311548793848758, 9.834303086688251)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pyproj</span><span class="w"> </span><span class="kn">import</span> <span class="n">Transformer</span>

        <span class="n">from_crs</span> <span class="o">=</span> <span class="n">check_crs</span><span class="p">(</span><span class="n">from_crs</span><span class="p">)</span>
        <span class="n">to_crs</span> <span class="o">=</span> <span class="n">check_crs</span><span class="p">(</span><span class="n">to_crs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">wsg84_order</span> <span class="o">==</span> <span class="s2">&quot;lat_lon&quot;</span> <span class="ow">and</span> <span class="n">from_crs</span> <span class="o">==</span> <span class="mi">4326</span><span class="p">:</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">transformer</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EPSG:</span><span class="si">{</span><span class="n">from_crs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;EPSG:</span><span class="si">{</span><span class="n">to_crs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="n">MINX</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="n">MINY</span><span class="p">])</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="n">MAXX</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="n">MAXY</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">wsg84_order</span> <span class="o">==</span> <span class="s2">&quot;lat_lon&quot;</span> <span class="ow">and</span> <span class="n">to_crs</span> <span class="o">==</span> <span class="mi">4326</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@deprecated_kwarg</span><span class="p">(</span><span class="s2">&quot;namespace&quot;</span><span class="p">,</span> <span class="s2">&quot;database&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_collection_by_bbox</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">bbox</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">comparison_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contains&quot;</span><span class="p">,</span>
        <span class="n">bbox_crs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4326</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;id&gt;-1&quot;</span><span class="p">,</span>
        <span class="n">op</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;AND&quot;</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">wsg84_order</span><span class="o">=</span><span class="s2">&quot;lat_lon&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Query the database by a bounding box. Please be careful with the bbox crs. The easiest is</span>
<span class="sd">        using the same crs as the collection. However, if the bbox crs differs from the collection,</span>
<span class="sd">        the geoDB client will attempt to automatially transform the bbox crs according to the collection&#39;s crs.</span>
<span class="sd">        You can also directly use the method GeoDBClient.transform_bbox_crs yourself before you pass the bbox into</span>
<span class="sd">        this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The name of the collection to be quried</span>
<span class="sd">            bbox (Tuple[float, float, float, float]): minx, miny, maxx, maxy</span>
<span class="sd">            comparison_mode (str): Filter mode. Can be &#39;contains&#39; or &#39;within&#39; [&#39;contains&#39;]</span>
<span class="sd">            bbox_crs (int, str): Projection code. [4326]</span>
<span class="sd">            op (str): Operator for where (AND, OR) [&#39;AND&#39;]</span>
<span class="sd">            where (str): Additional SQL where statement to further filter the collection</span>
<span class="sd">            limit (int): The maximum number of rows to be returned</span>
<span class="sd">            offset (int): Offset (start) of rows to return. Used in combination with limit.</span>
<span class="sd">            database (str): The name of the database the collection resides in [current database]</span>
<span class="sd">            wsg84_order (str): WSG84 (EPSG:4326) is expected to be in Lat Lon format (&quot;lat_lon&quot;). Use &quot;lon_lat&quot; if</span>
<span class="sd">            Lon Lat is used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A GeoPandas Dataframe</span>

<span class="sd">        Raises:</span>
<span class="sd">            HttpError: When the database raises an error</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.get_collection_by_bbox(table=&quot;[MyCollection]&quot;, bbox=(452750.0, 88909.549, 464000.0, \</span>
<span class="sd">                102486.299), comparison_mode=&quot;contains&quot;, bbox_crs=3794, limit=10, offset=10)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bbox_crs</span> <span class="o">=</span> <span class="n">check_crs</span><span class="p">(</span><span class="n">bbox_crs</span><span class="p">)</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_collection_exists</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_stored_procedure_exists</span><span class="p">(</span><span class="s2">&quot;geodb_get_by_bbox&quot;</span><span class="p">)</span>

        <span class="n">coll_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection_srid</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">coll_crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">coll_crs</span> <span class="o">!=</span> <span class="n">bbox_crs</span><span class="p">:</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_bbox_crs</span><span class="p">(</span>
                    <span class="n">bbox</span><span class="p">,</span> <span class="n">bbox_crs</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">coll_crs</span><span class="p">),</span> <span class="n">wsg84_order</span><span class="o">=</span><span class="n">wsg84_order</span>
                <span class="p">)</span>
                <span class="n">bbox_crs</span> <span class="o">=</span> <span class="n">coll_crs</span>

            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/vnd.pgrst.object+json&quot;</span><span class="p">}</span>

            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="s2">&quot;/rpc/geodb_get_by_bbox&quot;</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
                    <span class="s2">&quot;minx&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;miny&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;maxx&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="s2">&quot;maxy&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                    <span class="s2">&quot;comparison_mode&quot;</span><span class="p">:</span> <span class="n">comparison_mode</span><span class="p">,</span>
                    <span class="s2">&quot;bbox_crs&quot;</span><span class="p">:</span> <span class="n">bbox_crs</span><span class="p">,</span>
                    <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                    <span class="s2">&quot;where&quot;</span><span class="p">:</span> <span class="n">where</span><span class="p">,</span>
                    <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="n">op</span><span class="p">,</span>
                    <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>

            <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;src&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
                <span class="n">srid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection_srid</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_from_json</span><span class="p">(</span><span class="n">js</span><span class="p">,</span> <span class="n">srid</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Empty Result&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">count_collection_rows</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exact_count</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Message</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the number of rows in the given collection. By default, this</span>
<span class="sd">        function returns a rough estimate within the order of magnitude of the</span>
<span class="sd">        actual number; the exact count can also be retrieved, but this may take</span>
<span class="sd">        much longer.</span>
<span class="sd">        Note: in some cases, no estimate can be provided. In such cases,</span>
<span class="sd">        -1 is returned if exact_count == False.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str):   The name of the collection</span>
<span class="sd">            database (str):     The name of the database the collection resides</span>
<span class="sd">                                in [current database]</span>
<span class="sd">            exact_count (bool): If True, the actual number of rows will be</span>
<span class="sd">                                counted. Default value: false.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the number of rows in the given collection, or -1 if exact_count</span>
<span class="sd">            is False and no estimate could be provided.</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError: When the database raises an error</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.count_collection_rows(&#39;my_collection&#39;], exact_count=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exact_count</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                    <span class="s2">&quot;/rpc/geodb_count_collection&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">}</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                    <span class="s2">&quot;/rpc/geodb_estimate_collection_count&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">}</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">count_collection_by_bbox</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">bbox</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">comparison_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contains&quot;</span><span class="p">,</span>
        <span class="n">bbox_crs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4326</span><span class="p">,</span>
        <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;id&gt;-1&quot;</span><span class="p">,</span>
        <span class="n">op</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;AND&quot;</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">wsg84_order</span><span class="o">=</span><span class="s2">&quot;lat_lon&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Query the database by a bounding box and return the count. Please be careful with the bbox crs. The easiest is</span>
<span class="sd">        using the same crs as the collection. However, if the bbox crs differs from the collection,</span>
<span class="sd">        the geoDB client will attempt to automatially transform the bbox crs according to the collection&#39;s crs.</span>
<span class="sd">        You can also directly use the method GeoDBClient.transform_bbox_crs yourself before you pass the bbox into</span>
<span class="sd">        this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The name of the collection to be quried</span>
<span class="sd">            bbox (Tuple[float, float, float, float]): minx, miny, maxx, maxy</span>
<span class="sd">            comparison_mode (str): Filter mode. Can be &#39;contains&#39; or &#39;within&#39; [&#39;contains&#39;]</span>
<span class="sd">            bbox_crs (int, str): Projection code. [4326]</span>
<span class="sd">            op (str): Operator for where (AND, OR) [&#39;AND&#39;]</span>
<span class="sd">            where (str): Additional SQL where statement to further filter the collection</span>
<span class="sd">            database (str): The name of the database the collection resides in [current database]</span>
<span class="sd">            wsg84_order (str): WSG84 (EPSG:4326) is expected to be in Lat Lon format (&quot;lat_lon&quot;). Use &quot;lon_lat&quot; if</span>
<span class="sd">            Lon Lat is used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A GeoPandas Dataframe</span>

<span class="sd">        Raises:</span>
<span class="sd">            HttpError: When the database raises an error</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.count_collection_by_bbox(table=&quot;[MyCollection]&quot;, bbox=(452750.0, 88909.549, 464000.0, \</span>
<span class="sd">                102486.299), comparison_mode=&quot;contains&quot;, bbox_crs=3794)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bbox_crs</span> <span class="o">=</span> <span class="n">check_crs</span><span class="p">(</span><span class="n">bbox_crs</span><span class="p">)</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_collection_exists</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_stored_procedure_exists</span><span class="p">(</span><span class="s2">&quot;geodb_get_by_bbox&quot;</span><span class="p">)</span>

        <span class="n">coll_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection_srid</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">coll_crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">coll_crs</span> <span class="o">!=</span> <span class="n">bbox_crs</span><span class="p">:</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_bbox_crs</span><span class="p">(</span>
                    <span class="n">bbox</span><span class="p">,</span> <span class="n">bbox_crs</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">coll_crs</span><span class="p">),</span> <span class="n">wsg84_order</span><span class="o">=</span><span class="n">wsg84_order</span>
                <span class="p">)</span>
                <span class="n">bbox_crs</span> <span class="o">=</span> <span class="n">coll_crs</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/vnd.pgrst.object+json&quot;</span><span class="p">}</span>

            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="s2">&quot;/rpc/geodb_count_by_bbox&quot;</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
                    <span class="s2">&quot;minx&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;miny&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;maxx&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="s2">&quot;maxy&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                    <span class="s2">&quot;comparison_mode&quot;</span><span class="p">:</span> <span class="n">comparison_mode</span><span class="p">,</span>
                    <span class="s2">&quot;bbox_crs&quot;</span><span class="p">:</span> <span class="n">bbox_crs</span><span class="p">,</span>
                    <span class="s2">&quot;where&quot;</span><span class="p">:</span> <span class="n">where</span><span class="p">,</span>
                    <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="n">op</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>

            <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;src&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
                <span class="n">srid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection_srid</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_from_json</span><span class="p">(</span><span class="n">js</span><span class="p">,</span> <span class="n">srid</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Empty Result&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">head_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">num_lines</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the first num_lines of a collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The collection&#39;s name</span>
<span class="sd">            num_lines (int): The number of line to return</span>
<span class="sd">            database (str): The name of the database the collection resides in [current database]</span>

<span class="sd">        Returns:</span>
<span class="sd">            GeoDataFrame or DataFrame: results</span>

<span class="sd">        Raises:</span>
<span class="sd">            HttpError: When the database raises an error</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.head_collection(collection=&#39;[MyCollection]&#39;, num_lines=10)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span>
            <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;limit=</span><span class="si">{</span><span class="n">num_lines</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Query a collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The collection&#39;s name.</span>
<span class="sd">            query (str): A query. Follow the http://postgrest.org/en/v6.0/api.html query convention.</span>
<span class="sd">            database (str): The name of the database the collection resides in [current database].</span>
<span class="sd">            limit (int): The maximum number of rows to be returned.</span>
<span class="sd">            offset (int): Offset (start) of rows to return. Used in combination with limit.</span>

<span class="sd">        Returns:</span>
<span class="sd">            GeoDataFrame or DataFrame: results</span>

<span class="sd">        Raises:</span>
<span class="sd">            HttpError: When the database raises an error</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.get_collection(collection=&#39;[MyCollection]&#39;, query=&#39;id=ge.1000&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">srid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection_srid</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>

        <span class="n">tab_prefix</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tab_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">actual_query</span> <span class="o">=</span> <span class="n">query</span> <span class="k">if</span> <span class="n">query</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">limit</span> <span class="ow">or</span> <span class="n">offset</span><span class="p">:</span>
                <span class="n">actual_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&amp;&quot;</span> <span class="k">if</span> <span class="n">query</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="n">actual_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">actual_query</span><span class="si">}</span><span class="s2">limit=</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2">&amp;offset=</span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">if</span> <span class="n">actual_query</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">actual_query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_from_json</span><span class="p">(</span><span class="n">js</span><span class="p">,</span> <span class="n">srid</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Empty Result&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># noinspection SqlDialectInspection,SqlNoDataSourceInspection,SqlInjection</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_collection_pg</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">select</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
        <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">group</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">offset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The name of the collection to query</span>
<span class="sd">            select (str): Properties (columns) to return. Can contain aggregation functions</span>
<span class="sd">            where (Optional[str]): SQL WHERE statement</span>
<span class="sd">            group (Optional[str]): SQL GROUP statement</span>
<span class="sd">            order (Optional[str]): SQL ORDER statement</span>
<span class="sd">            limit (Optional[int]): Limit for paging</span>
<span class="sd">            offset (Optional[int]): Offset (start) of rows to return. Used in combination with limit.</span>
<span class="sd">            database (str): The name of the database the collection resides in [current database]</span>

<span class="sd">        Returns:</span>
<span class="sd">            GeoDataFrame or DataFrame: results</span>

<span class="sd">        Raises:</span>
<span class="sd">            HttpError: When the database raises an error</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; df = geodb.get_collection_pg(collection=&#39;[MyCollection]&#39;, where=&#39;raba_id=1410&#39;, group=&#39;d_od&#39;, \</span>
<span class="sd">                select=&#39;COUNT(d_od) as ct, d_od&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tab_prefix</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tab_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_collection_exists</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_stored_procedure_exists</span><span class="p">(</span><span class="s2">&quot;geodb_get_pg&quot;</span><span class="p">)</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/vnd.pgrst.object+json&quot;</span><span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="s2">&quot;/rpc/geodb_get_pg&quot;</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;select&quot;</span><span class="p">:</span> <span class="n">select</span><span class="p">,</span>
                    <span class="s2">&quot;where&quot;</span><span class="p">:</span> <span class="n">where</span><span class="p">,</span>
                    <span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
                    <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                    <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="n">order</span><span class="p">,</span>
                    <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                    <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

            <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;src&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
                <span class="n">srid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection_srid</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_from_json</span><span class="p">(</span><span class="n">js</span><span class="p">,</span> <span class="n">srid</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Empty Result&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new index on the given collection and the given property.</span>
<span class="sd">        This may drastically speed up your queries, but adding too many</span>
<span class="sd">        indexes on a collection might also hamper its performance. Please use</span>
<span class="sd">        with care, and use only if you know what you are doing.</span>

<span class="sd">        In case you are doing lots of geographical queries, you&#39;ll probably</span>
<span class="sd">        want to add an index to your geometry column like this:</span>

<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">            &gt;&gt;&gt; geodb.create_index(collection=&#39;[MyCollection]&#39;,</span>
<span class="sd">                                   prop=&#39;geometry&#39;)</span>

<span class="sd">        Note that you may remove your indexes using `remove_index`.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The collection&#39;s name</span>
<span class="sd">            prop (str): The name of the property to add an index to.</span>
<span class="sd">                        Use `get_collection_info` to get the list of</span>
<span class="sd">                        properties for a collection.</span>
<span class="sd">            database (str): The name of the database the collection resides</span>
<span class="sd">                            in [current database].</span>
<span class="sd">        Returns:</span>
<span class="sd">            A message if the index was successfully created.</span>
<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError if the index already exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_create_index&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
            <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="n">prop</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">INDEX_CREATED</span><span class="p">,</span> <span class="s2">&quot;table </span><span class="si">{dn}</span><span class="s2"> and property </span><span class="si">{prop}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created new index on table </span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2"> and property </span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">show_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows the indexes on the given collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The collection&#39;s name</span>
<span class="sd">            database (str): The name of the database the collection resides</span>
<span class="sd">                            in [current database].</span>
<span class="sd">        Returns:</span>
<span class="sd">            A dataframe containing the list of indexes for the given</span>
<span class="sd">            collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_show_indexes&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the index on the given collection and the given property.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The collection&#39;s name</span>
<span class="sd">            prop (str): The name of the property to add an index to.</span>
<span class="sd">            database (str): The name of the database the collection resides</span>
<span class="sd">                            in [current database].</span>
<span class="sd">        Returns:</span>
<span class="sd">            A message if the index was successfully removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_drop_index&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
            <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="n">prop</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">INDEX_DROPPED</span><span class="p">,</span> <span class="s2">&quot;table </span><span class="si">{dn}</span><span class="s2"> and property </span><span class="si">{prop}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed index from table </span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2"> and property </span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">server_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get URL of the geoDB server.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The URL of the geoDB REST service</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_url</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_collection_srid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="n">Message</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the SRID of a collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The collection&#39;s name</span>
<span class="sd">            database (str): The name of the database the collection resides in [current database]</span>

<span class="sd">        Returns:</span>
<span class="sd">            The name of the SRID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tab_prefix</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tab_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_get_collection_srid&quot;</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">},</span>
                <span class="n">raise_for_status</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;src&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">js</span><span class="p">[</span><span class="s2">&quot;srid&quot;</span><span class="p">]</span>

            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_df_from_json</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">js</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">srid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts wkb geometry string to wkt from a PostGREST JSON result.</span>
<span class="sd">        Args:</span>
<span class="sd">            js (Dict): The geometries to be converted</span>
<span class="sd">            srid (Optional[int]):.</span>

<span class="sd">        Returns:</span>
<span class="sd">            GeoDataFrame, DataFrame</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">js</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_convert_geo</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">js</span><span class="p">]</span>

        <span class="n">gpdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;geometry&quot;</span> <span class="ow">in</span> <span class="n">gpdf</span><span class="p">:</span>
            <span class="n">crs</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;EPSG:</span><span class="si">{</span><span class="n">srid</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">srid</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">gpdf</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">crs</span>
            <span class="k">return</span> <span class="n">gpdf</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">gpdf</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_full_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): PostgREST API path</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Full URL and path</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">server_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_url</span>
        <span class="n">server_port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_port</span>

        <span class="k">if</span> <span class="s2">&quot;services/xcube_geoserv&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">server_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_url</span>
            <span class="n">server_port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_port</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_winchester_gs</span> <span class="ow">and</span> <span class="s2">&quot;geodb_geoserver&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">server_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gs_server_url</span>
            <span class="n">server_port</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">server_port</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">server_url</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">server_port</span><span class="si">}{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">server_url</span><span class="si">}{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_geo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            row: A row of the PostgREST result</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict: The input row of the PostgREST result with its geometry</span>
<span class="sd">                  converted to wkt</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;geometry&quot;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span> <span class="ow">and</span> <span class="s2">&quot;coordinates&quot;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]:</span>
                <span class="n">geom</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span>
                <span class="n">row</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geom</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">row</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wkb</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">],</span> <span class="nb">hex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">row</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">publish_gs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Publishes collection to a BC geoservice (geoserver instance). Requires</span>
<span class="sd">        access registration.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): Name of the collection</span>
<span class="sd">            database (Optional[str]): Name of the database. Defaults to user</span>
<span class="sd">                                    database</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_winchester_gs</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_put</span><span class="p">(</span>
                    <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/geodb_geoserver/</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">/collections/&quot;</span><span class="p">,</span>
                    <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection_id&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">},</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_put</span><span class="p">(</span>
                    <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/api/v2/services/xcube_geoserv/databases/&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">/collections&quot;</span><span class="p">,</span>
                    <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection_id&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">},</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span>
                <span class="n">EventType</span><span class="o">.</span><span class="n">PUBLISHED_GS</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_published_gs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">Message</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            database (str): The database to list collections from a database which are published via geoserver</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Dataframe of collection names</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;/api/v2/services/xcube_geoserv/collections&quot;</span> <span class="k">if</span> <span class="n">database</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
            <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">js</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;collection&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_published_gs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">Message</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            database (str): The database to list collections from a database which are published via geoserver</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Dataframe of collection names</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; geodb = GeoDBClient(auth_mode=&#39;client-credentials&#39;, client_id=&#39;***&#39;, client_secret=&#39;***&#39;)</span>
<span class="sd">            &gt;&gt;&gt; geodb.get_published_gs()</span>
<span class="sd">                owner	                        database	                    collection</span>
<span class="sd">            0	geodb_9bfgsdfg-453f-445b-a459	geodb_9bfgsdfg-453f-445b-a459	land_use</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_winchester_gs</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/geodb_geoserver/</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">/collections&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/api/v2/services/xcube_geoserv/databases/</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">/collections&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
            <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">js</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;collection&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">unpublish_gs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &#39;Unpublishes&#39; collection from a BC geoservice (geoserver instance).</span>
<span class="sd">        Requires access registration.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): Name of the collection</span>
<span class="sd">            database (Optional[str]): Name of the database. Defaults to user</span>
<span class="sd">                                      database</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_winchester_gs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">(</span>
                    <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/geodb_geoserver/&quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">/collections/</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">(</span>
                    <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/api/v2/services/xcube_geoserv/databases/&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">/collections/</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span>
                <span class="n">EventType</span><span class="o">.</span><span class="n">UNPUBLISHED_GS</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">Message</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> in database </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;deleted from Geoservice&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new group with the given name, and makes the current user</span>
<span class="sd">        admin of that group: the current user can now add or remove users to</span>
<span class="sd">        and from the group, and all group users can publish or unpublish their</span>
<span class="sd">        collections to or from the group. Per default, no collection is</span>
<span class="sd">        published to the group.</span>
<span class="sd">        This function is restricted to users with a subscription of type</span>
<span class="sd">        &#39;manage&#39; (or related).</span>

<span class="sd">        Args:</span>
<span class="sd">            group_name (str): Name of the group to create.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A message if the group was successfully created.</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError if the group already exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_create_role&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="p">,</span>
            <span class="s2">&quot;user_group&quot;</span><span class="p">:</span> <span class="n">group_name</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">GROUP_CREATED</span><span class="p">,</span> <span class="n">group_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created new group </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_user_to_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the user to the given group.</span>

<span class="sd">        Args:</span>
<span class="sd">            user (str): Name of the user.</span>
<span class="sd">            group (str): Name of the group.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A message if the user was added to the group.</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError if (1) the user does not exist, (2) the group does not</span>
<span class="sd">            exist, (3) the current user does not have</span>
<span class="sd">            sufficient rights to add the user to the group.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_group_grant&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
            <span class="s2">&quot;user_group&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">GROUP_ADDED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added user </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_user_from_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the user from the given group.</span>

<span class="sd">        Args:</span>
<span class="sd">            user (str): Name of the user.</span>
<span class="sd">            group (str): Name of the group.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A message if the user was removed from the group.</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError if (1) the user does not exist, (2) the group does not</span>
<span class="sd">            exist, (3) the current user does not have</span>
<span class="sd">            sufficient rights to remove the user from the group.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_group_revoke&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
            <span class="s2">&quot;user_group&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">GROUP_REMOVED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed user </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">publish_collection_to_group</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Publishes the collection to the given group. Group members get read</span>
<span class="sd">        and write access to the collection; they</span>
<span class="sd">        cannot publish the collection to other users or groups.</span>
<span class="sd">        This is only allowed if the current user is the owner of the</span>
<span class="sd">        collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The collection&#39;s name</span>
<span class="sd">            group (str): Name of the group.</span>
<span class="sd">            database (str): The name of the database the collection resides</span>
<span class="sd">            in [current database].</span>

<span class="sd">        Returns:</span>
<span class="sd">            A message if the collection was published to the group.</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError if (1) the collection does not exist, (2) the group</span>
<span class="sd">            does not exist,</span>
<span class="sd">            (3) the current user is not the owner of the collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_owner_of</span><span class="p">(</span><span class="n">dn</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="si">}</span><span class="s2"> must be owner of collection &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2"> to publish.&quot;</span>
            <span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_group_publish_collection&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
            <span class="s2">&quot;user_group&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">PUBLISHED_GROUP</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Published collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> in database &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> to group </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">unpublish_collection_from_group</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unpublishes the collection from the given group.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The collection&#39;s name</span>
<span class="sd">            database (str): The name of the database the collection resides</span>
<span class="sd">            in [current database].</span>
<span class="sd">            group (str): Name of the group.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A message if the collection was unpublished from the group.</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError if (1) the collection does not exist, (2) the group</span>
<span class="sd">            does not exist,</span>
<span class="sd">            (3) the current user is not the owner of the collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_owner_of</span><span class="p">(</span><span class="n">dn</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="si">}</span><span class="s2"> must be owner of &quot;</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2"> to unpublish.&quot;</span>
            <span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_group_unpublish_collection&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
            <span class="s2">&quot;user_group&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">UNPUBLISHED_GROUP</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unpublished collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> in database &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> from group </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">publish_database_to_group</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Publishes the database to the given group and enables group users to write into the same database.</span>
<span class="sd">        For example, if some user A creates the database `someproject`, users that share a group G with A are</span>
<span class="sd">        allowed to create new collections in that database (like `someproject_insitudata`) if A publishes the database</span>
<span class="sd">        to the group G. Group users shall not, however, be allowed to read or write any existing collection in the</span>
<span class="sd">        database; this needs extra permission by the group admin, using the already existing function</span>
<span class="sd">        `publish_collection_to_group`.</span>

<span class="sd">        Args:</span>
<span class="sd">            database (str): The name of the database to publish. Default: the username.</span>
<span class="sd">            group (str): Name of the group.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_dummy&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_owner_of</span><span class="p">(</span><span class="n">dn</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="si">}</span><span class="s2"> must be owner of database &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> to publish.&quot;</span>
            <span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_group_publish_database&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="n">database</span><span class="p">,</span>
            <span class="s2">&quot;user_group&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">PUBLISHED_DATABASE</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Published database </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> to group </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">unpublish_database_from_group</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unpublishes the database from the given group.</span>

<span class="sd">        Args:</span>
<span class="sd">            database (str): The name of the database to unpublish. Default: the username.</span>
<span class="sd">            group (str): Name of the group.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_dummy&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_owner_of</span><span class="p">(</span><span class="n">dn</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="si">}</span><span class="s2"> must be owner of database &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> to unpublish.&quot;</span>
            <span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_group_unpublish_database&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="n">database</span><span class="p">,</span>
            <span class="s2">&quot;user_group&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">UNPUBLISHED_DATABASE</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unpublished database </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> from group </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_my_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the different group memberships of the current user.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The different group memberships of the current user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_get_user_roles&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="p">})</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span>
            <span class="s2">&quot;src&quot;</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="s2">&quot;rolname&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">[</span><span class="s2">&quot;rolname&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_group_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the users that are member of the given group.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the users that are member of the given group.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_get_group_users&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;group_name&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">})</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;res&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">name</span><span class="p">[</span><span class="s2">&quot;rolname&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_access_rights</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the access rights on the given collection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The access rights on the collection of the current user and all</span>
<span class="sd">            groups the user is in.</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError if the collection does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_get_grants&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">})</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;res&quot;</span><span class="p">])</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;grantee&quot;</span><span class="p">)[</span><span class="s2">&quot;privilege_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_owner_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_user_allowed&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
            <span class="s2">&quot;usr&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">auth_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the user&#39;s access token.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The current authentication access_token</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError on missing ipython shell</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">access_token_uri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_access_token_uri</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_auth_access_token</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_geodb_client_credentials_access_token</span><span class="p">(</span>
                <span class="n">token_uri</span><span class="o">=</span><span class="n">access_token_uri</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_use_winchester_gs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># check if Winchester is the interface to the Geoserver:</span>
            <span class="c1"># extract base URL from the authentication URL and retrieve the server&#39;s meta</span>
            <span class="c1"># information, look for &#39;winchester&#39; in its list of APIs. Returns &quot;False&quot; if</span>
            <span class="c1"># the meta information is structured differently, or does not contain</span>
            <span class="c1"># the &#39;winchester&#39;-API.</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_auth_domain</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">netloc</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">apis</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">())[</span><span class="s2">&quot;apis&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">api</span> <span class="ow">in</span> <span class="n">apis</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;winchester&quot;</span> <span class="ow">in</span> <span class="n">api</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_auth_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refresh the authentication token.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth_access_token</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_raise_for_invalid_password_cfg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raise when the password configuration is wrong.</span>

<span class="sd">        Returns:</span>
<span class="sd">             True on success</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError on invalid configuration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_auth_username</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_password</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_id</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_mode</span> <span class="o">==</span> <span class="s2">&quot;password&quot;</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="s2">&quot;System: Invalid password flow configuration&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_raise_for_invalid_client_credentials_cfg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raise when the client-credentials configuration is wrong.</span>

<span class="sd">        Returns:</span>
<span class="sd">             True on success</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError on invalid configuration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_id</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_secret</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_aud</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_mode</span> <span class="o">==</span> <span class="s2">&quot;client-credentials&quot;</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="s2">&quot;System: Invalid client_credentials configuration.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_geodb_client_credentials_access_token</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">token_uri</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/oauth/token&quot;</span><span class="p">,</span> <span class="n">is_json</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get access token from client credentials</span>

<span class="sd">        Args:</span>
<span class="sd">            token_uri (str): oauth2 token URI</span>
<span class="sd">            is_json: whether the request has to be of content type json</span>

<span class="sd">        Returns:</span>
<span class="sd">             An access token</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError, HttpError</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_mode</span> <span class="o">==</span> <span class="s2">&quot;client-credentials&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_invalid_client_credentials_cfg</span><span class="p">()</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_id</span><span class="p">,</span>
                <span class="s2">&quot;client_secret&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_secret</span><span class="p">,</span>
                <span class="s2">&quot;audience&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_aud</span><span class="p">,</span>
                <span class="s2">&quot;grant_type&quot;</span><span class="p">:</span> <span class="s2">&quot;client_credentials&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span> <span class="k">if</span> <span class="n">is_json</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_auth_domain</span> <span class="o">+</span> <span class="n">token_uri</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_mode</span> <span class="o">==</span> <span class="s2">&quot;password&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_invalid_password_cfg</span><span class="p">()</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_id</span><span class="p">,</span>
                <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_username</span><span class="p">,</span>
                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_password</span><span class="p">,</span>
                <span class="s2">&quot;grant_type&quot;</span><span class="p">:</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_aud</span><span class="p">:</span>
                <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;audience&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_aud</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_secret</span><span class="p">:</span>
                <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;client_secret&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_client_secret</span>

            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">}</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_auth_domain</span> <span class="o">+</span> <span class="n">token_uri</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="s2">&quot;System Error: auth mode unknown.&quot;</span><span class="p">)</span>

        <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_auth_access_token</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span>
                <span class="s2">&quot;The authorization request did not return an access token.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">collection_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether a collection exists</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): The collection&#39;s name</span>
<span class="sd">            database (str): The name of the database the collection resides in [current database]</span>
<span class="sd">        Returns:</span>
<span class="sd">             Whether the collection exists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">head_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_raise_for_collection_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            collection (str): Name of the collection</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the collection exists</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError if the collection does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">collection_exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_exists</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">collection_exists</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_raise_for_stored_procedure_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stored_procedure</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            stored_procedure (str): Name of the stored procedure</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the stored procedure exists</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError if the stored procedure does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;/rpc/</span><span class="si">{</span><span class="n">stored_procedure</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">[</span><span class="s2">&quot;paths&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stored procedure </span><span class="si">{</span><span class="n">stored_procedure</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_event_log</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">event_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EventType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            collection (str):       The name of the collection for which to get</span>
<span class="sd">                                    the event log; if None, all collections are</span>
<span class="sd">                                    returned</span>
<span class="sd">            database (str):         The database of the collection</span>
<span class="sd">            event_type (EventType): The type of the events for which to get</span>
<span class="sd">                                    the event log; if None, all events are</span>
<span class="sd">                                    returned</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the stored procedure exists</span>

<span class="sd">        Raises:</span>
<span class="sd">            GeoDBError if the stored procedure does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/get_geodb_eventlog&quot;</span>
        <span class="k">if</span> <span class="n">event_type</span> <span class="ow">or</span> <span class="n">collection</span> <span class="ow">or</span> <span class="n">database</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">?&quot;</span>
        <span class="k">if</span> <span class="n">event_type</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">event_type=</span><span class="si">{</span><span class="n">event_type</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">collection</span> <span class="ow">or</span> <span class="n">database</span><span class="p">:</span>
            <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span> <span class="ow">or</span> <span class="s2">&quot;%&quot;</span>
            <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&amp;collection=</span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_log_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="n">event</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="n">event_type</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_log_event&quot;</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="n">event</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Prefer&quot;</span><span class="p">:</span> <span class="s2">&quot;params=single-object&quot;</span><span class="p">},</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span>
        <span class="n">host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">port</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">user</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">passwd</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dbname</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">conn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up  the database. Needs DB credentials and the database user requires CREATE TABLE/FUNCTION grants.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">host</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_DB_HOST&quot;</span><span class="p">)</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">port</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_DB_PORT&quot;</span><span class="p">)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">user</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_DB_USER&quot;</span><span class="p">)</span>
        <span class="n">passwd</span> <span class="o">=</span> <span class="n">passwd</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_DB_PASSWD&quot;</span><span class="p">)</span>
        <span class="n">dbname</span> <span class="o">=</span> <span class="n">dbname</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_DB_DBNAME&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">psycopg2</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="s2">&quot;You need to install psycopg2 first to run this module.&quot;</span><span class="p">)</span>

        <span class="n">conn</span> <span class="o">=</span> <span class="n">conn</span> <span class="ow">or</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">passwd</span><span class="p">,</span> <span class="n">dbname</span><span class="o">=</span><span class="n">dbname</span>
        <span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;xcube_geodb/sql/geodb.sql&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sql_file</span><span class="p">:</span>
            <span class="n">sql_create</span> <span class="o">=</span> <span class="n">sql_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create</span><span class="p">)</span>

        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="xcube_geodb.core.geodb.GeoDBClient.auth_access_token" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">auth_access_token</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Get the user's access token.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>str</code>
              –
              <div class="doc-md-description">
                <p>The current authentication access_token</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="xcube_geodb.core.geodb.GeoDBClient.capabilities" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">capabilities</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Dict">Dict</span></code>
              –
              <div class="doc-md-description">
                <p>A dictionary of the geoDB PostGrest REST API service's capabilities</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="xcube_geodb.core.geodb.GeoDBClient.database" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">database</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>str</code>
              –
              <div class="doc-md-description">
                <p>The current database</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="xcube_geodb.core.geodb.GeoDBClient.raise_it" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">raise_it</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>bool</code>
              –
              <div class="doc-md-description">
                <p>The current error message behaviour</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="xcube_geodb.core.geodb.GeoDBClient.server_url" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">server_url</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Get URL of the geoDB server.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>str</code></b>(                  <code>str</code>
)              –
              <div class="doc-md-description">
                <p>The URL of the geoDB REST service</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="xcube_geodb.core.geodb.GeoDBClient.whoami" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">whoami</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>str</code>
              –
              <div class="doc-md-description">
                <p>The current database user</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>    </div>

</div>



<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.add_properties" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_properties</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Add properties to a collection.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to add properties to</p>
              </div>
            </li>
            <li>
              <b><code>properties</code></b>
                  (<code><span title="typing.Dict">Dict</span></code>)
              –
              <div class="doc-md-description">
                <p>Property definitions as dictionary</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the collection resides in [current
            database]</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Returns:
    Message: Whether the operation succeeded</p>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">properties</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;[MyName1]&#39;</span><span class="p">:</span> <span class="s1">&#39;[PostgresType1]&#39;</span><span class="p">,</span>                               <span class="s1">&#39;[MyName2]&#39;</span><span class="p">:</span> <span class="s1">&#39;[PostgresType2]&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">add_property</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="s1">&#39;[MyCollection]&#39;</span><span class="p">,</span>                                    <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_properties</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add properties to a collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The name of the collection to add properties to</span>
<span class="sd">        properties (Dict): Property definitions as dictionary</span>
<span class="sd">        database (str): The database the collection resides in [current</span>
<span class="sd">                        database]</span>
<span class="sd">    Returns:</span>
<span class="sd">        Message: Whether the operation succeeded</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; properties = {&#39;[MyName1]&#39;: &#39;[PostgresType1]&#39;, \</span>
<span class="sd">                          &#39;[MyName2]&#39;: &#39;[PostgresType2]&#39;}</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.add_property(collection=&#39;[MyCollection]&#39;, \</span>
<span class="sd">                               properties=properties)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_capabilities</span><span class="p">()</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_add_properties&quot;</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span> <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">prop_name</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
            <span class="n">prop_type</span> <span class="o">=</span> <span class="n">properties</span><span class="p">[</span><span class="n">prop_name</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span>
                <span class="n">EventType</span><span class="o">.</span><span class="n">PROPERTY_ADDED</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="s2">name: </span><span class="si">{</span><span class="n">prop_name</span><span class="si">}</span><span class="s2">, &quot;</span> <span class="sa">f</span><span class="s2">&quot;type: </span><span class="si">{</span><span class="n">prop_type</span><span class="si">}</span><span class="se">}}</span><span class="s2"> to collection </span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Properties added&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.add_property" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_property</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Add a property to an existing collection.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to add a property to</p>
              </div>
            </li>
            <li>
              <b><code>prop</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Property name</p>
              </div>
            </li>
            <li>
              <b><code>typ</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The data type of the property (Postgres type)</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the collection resides in [current
            database]</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>Message</code></b>(                  <code><span title="xcube_geodb.core.message.Message">Message</span></code>
)              –
              <div class="doc-md-description">
                <p>Success message</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">add_property</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="s1">&#39;[MyCollection]&#39;</span><span class="p">,</span>                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;[MyProperty]&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;[PostgresType]&#39;</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_property</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">typ</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a property to an existing collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The name of the collection to add a property to</span>
<span class="sd">        prop (str): Property name</span>
<span class="sd">        typ (str): The data type of the property (Postgres type)</span>
<span class="sd">        database (str): The database the collection resides in [current</span>
<span class="sd">                        database]</span>

<span class="sd">    Returns:</span>
<span class="sd">        Message: Success message</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.add_property(collection=&#39;[MyCollection]&#39;, \</span>
<span class="sd">            name=&#39;[MyProperty]&#39;, type=&#39;[PostgresType]&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prop</span> <span class="o">=</span> <span class="p">{</span><span class="n">prop</span><span class="p">:</span> <span class="n">typ</span><span class="p">}</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_properties</span><span class="p">(</span>
        <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.add_user_to_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_user_to_group</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Adds the user to the given group.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>user</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Name of the user.</p>
              </div>
            </li>
            <li>
              <b><code>group</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Name of the group.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="xcube_geodb.core.message.Message">Message</span></code>
              –
              <div class="doc-md-description">
                <p>A message if the user was added to the group.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span>
<span class="normal">2475</span>
<span class="normal">2476</span>
<span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_user_to_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds the user to the given group.</span>

<span class="sd">    Args:</span>
<span class="sd">        user (str): Name of the user.</span>
<span class="sd">        group (str): Name of the group.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A message if the user was added to the group.</span>

<span class="sd">    Raises:</span>
<span class="sd">        GeoDBError if (1) the user does not exist, (2) the group does not</span>
<span class="sd">        exist, (3) the current user does not have</span>
<span class="sd">        sufficient rights to add the user to the group.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_group_grant&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
        <span class="s2">&quot;user_group&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">GROUP_ADDED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added user </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.collection_exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collection_exists</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Checks whether a collection exists</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The collection's name</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the database the collection resides in [current database]</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Returns:
     Whether the collection exists</p>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span>
<span class="normal">2884</span>
<span class="normal">2885</span>
<span class="normal">2886</span>
<span class="normal">2887</span>
<span class="normal">2888</span>
<span class="normal">2889</span>
<span class="normal">2890</span>
<span class="normal">2891</span>
<span class="normal">2892</span>
<span class="normal">2893</span>
<span class="normal">2894</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">collection_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks whether a collection exists</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The collection&#39;s name</span>
<span class="sd">        database (str): The name of the database the collection resides in [current database]</span>
<span class="sd">    Returns:</span>
<span class="sd">         Whether the collection exists</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.copy_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">copy_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">new_collection</span><span class="p">,</span> <span class="n">new_database</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to be copied</p>
              </div>
            </li>
            <li>
              <b><code>new_collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The new name of the collection</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the collection resides in
            [current database]</p>
              </div>
            </li>
            <li>
              <b><code>new_database</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The database the collection will be copied to</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">copy_collection</span><span class="p">(</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="s1">&#39;col_new&#39;</span><span class="p">,</span> <span class="s1">&#39;target_db&#39;</span><span class="p">,</span>
<span class="go">                          &#39;source_db&#39;)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">copy_collection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">new_collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">new_database</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The name of the collection to be copied</span>
<span class="sd">        new_collection (str): The new name of the collection</span>
<span class="sd">        database (str): The database the collection resides in</span>
<span class="sd">                        [current database]</span>
<span class="sd">        new_database (str): The database the collection will be copied to</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.copy_collection(&#39;col&#39;, &#39;col_new&#39;, &#39;target_db&#39;,</span>
<span class="sd">                                  &#39;source_db&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span>
    <span class="n">from_dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">to_dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_collection</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_copy_collection&quot;</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;old_collection&quot;</span><span class="p">:</span> <span class="n">from_dn</span><span class="p">,</span> <span class="s2">&quot;new_collection&quot;</span><span class="p">:</span> <span class="n">to_dn</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">COPIED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">from_dn</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">to_dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection copied from </span><span class="si">{</span><span class="n">from_dn</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">to_dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.count_collection_by_bbox" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">count_collection_by_bbox</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">comparison_mode</span><span class="o">=</span><span class="s1">&#39;contains&#39;</span><span class="p">,</span> <span class="n">bbox_crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;id&gt;-1&#39;</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="s1">&#39;AND&#39;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wsg84_order</span><span class="o">=</span><span class="s1">&#39;lat_lon&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Query the database by a bounding box and return the count. Please be careful with the bbox crs. The easiest is
using the same crs as the collection. However, if the bbox crs differs from the collection,
the geoDB client will attempt to automatially transform the bbox crs according to the collection's crs.
You can also directly use the method GeoDBClient.transform_bbox_crs yourself before you pass the bbox into
this method.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to be quried</p>
              </div>
            </li>
            <li>
              <b><code>bbox</code></b>
                  (<code><span title="typing.Tuple">Tuple</span>[float, float, float, float]</code>)
              –
              <div class="doc-md-description">
                <p>minx, miny, maxx, maxy</p>
              </div>
            </li>
            <li>
              <b><code>comparison_mode</code></b>
                  (<code>str</code>, default:
                      <code>&#39;contains&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Filter mode. Can be 'contains' or 'within' ['contains']</p>
              </div>
            </li>
            <li>
              <b><code>bbox_crs</code></b>
                  (<code>(int, str)</code>, default:
                      <code>4326</code>
)
              –
              <div class="doc-md-description">
                <p>Projection code. [4326]</p>
              </div>
            </li>
            <li>
              <b><code>op</code></b>
                  (<code>str</code>, default:
                      <code>&#39;AND&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Operator for where (AND, OR) ['AND']</p>
              </div>
            </li>
            <li>
              <b><code>where</code></b>
                  (<code>str</code>, default:
                      <code>&#39;id&gt;-1&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Additional SQL where statement to further filter the collection</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database the collection resides in [current database]</p>
              </div>
            </li>
            <li>
              <b><code>wsg84_order</code></b>
                  (<code>str</code>, default:
                      <code>&#39;lat_lon&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>WSG84 (EPSG:4326) is expected to be in Lat Lon format ("lat_lon"). Use "lon_lat" if</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="geopandas.GeoDataFrame">GeoDataFrame</span>, <span title="pandas.DataFrame">DataFrame</span>]</code>
              –
              <div class="doc-md-description">
                <p>A GeoPandas Dataframe</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>HttpError</code>
              –
              <div class="doc-md-description">
                <p>When the database raises an error</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">count_collection_by_bbox</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="s2">&quot;[MyCollection]&quot;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="p">(</span><span class="mf">452750.0</span><span class="p">,</span> <span class="mf">88909.549</span><span class="p">,</span> <span class="mf">464000.0</span><span class="p">,</span>                 <span class="mf">102486.299</span><span class="p">),</span> <span class="n">comparison_mode</span><span class="o">=</span><span class="s2">&quot;contains&quot;</span><span class="p">,</span> <span class="n">bbox_crs</span><span class="o">=</span><span class="mi">3794</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">count_collection_by_bbox</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">bbox</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">comparison_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contains&quot;</span><span class="p">,</span>
    <span class="n">bbox_crs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4326</span><span class="p">,</span>
    <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;id&gt;-1&quot;</span><span class="p">,</span>
    <span class="n">op</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;AND&quot;</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">wsg84_order</span><span class="o">=</span><span class="s2">&quot;lat_lon&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Query the database by a bounding box and return the count. Please be careful with the bbox crs. The easiest is</span>
<span class="sd">    using the same crs as the collection. However, if the bbox crs differs from the collection,</span>
<span class="sd">    the geoDB client will attempt to automatially transform the bbox crs according to the collection&#39;s crs.</span>
<span class="sd">    You can also directly use the method GeoDBClient.transform_bbox_crs yourself before you pass the bbox into</span>
<span class="sd">    this method.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The name of the collection to be quried</span>
<span class="sd">        bbox (Tuple[float, float, float, float]): minx, miny, maxx, maxy</span>
<span class="sd">        comparison_mode (str): Filter mode. Can be &#39;contains&#39; or &#39;within&#39; [&#39;contains&#39;]</span>
<span class="sd">        bbox_crs (int, str): Projection code. [4326]</span>
<span class="sd">        op (str): Operator for where (AND, OR) [&#39;AND&#39;]</span>
<span class="sd">        where (str): Additional SQL where statement to further filter the collection</span>
<span class="sd">        database (str): The name of the database the collection resides in [current database]</span>
<span class="sd">        wsg84_order (str): WSG84 (EPSG:4326) is expected to be in Lat Lon format (&quot;lat_lon&quot;). Use &quot;lon_lat&quot; if</span>
<span class="sd">        Lon Lat is used.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A GeoPandas Dataframe</span>

<span class="sd">    Raises:</span>
<span class="sd">        HttpError: When the database raises an error</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.count_collection_by_bbox(table=&quot;[MyCollection]&quot;, bbox=(452750.0, 88909.549, 464000.0, \</span>
<span class="sd">            102486.299), comparison_mode=&quot;contains&quot;, bbox_crs=3794)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bbox_crs</span> <span class="o">=</span> <span class="n">check_crs</span><span class="p">(</span><span class="n">bbox_crs</span><span class="p">)</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_collection_exists</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_stored_procedure_exists</span><span class="p">(</span><span class="s2">&quot;geodb_get_by_bbox&quot;</span><span class="p">)</span>

    <span class="n">coll_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection_srid</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">coll_crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">coll_crs</span> <span class="o">!=</span> <span class="n">bbox_crs</span><span class="p">:</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_bbox_crs</span><span class="p">(</span>
                <span class="n">bbox</span><span class="p">,</span> <span class="n">bbox_crs</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">coll_crs</span><span class="p">),</span> <span class="n">wsg84_order</span><span class="o">=</span><span class="n">wsg84_order</span>
            <span class="p">)</span>
            <span class="n">bbox_crs</span> <span class="o">=</span> <span class="n">coll_crs</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/vnd.pgrst.object+json&quot;</span><span class="p">}</span>

        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
            <span class="s2">&quot;/rpc/geodb_count_by_bbox&quot;</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
                <span class="s2">&quot;minx&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;miny&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;maxx&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="s2">&quot;maxy&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                <span class="s2">&quot;comparison_mode&quot;</span><span class="p">:</span> <span class="n">comparison_mode</span><span class="p">,</span>
                <span class="s2">&quot;bbox_crs&quot;</span><span class="p">:</span> <span class="n">bbox_crs</span><span class="p">,</span>
                <span class="s2">&quot;where&quot;</span><span class="p">:</span> <span class="n">where</span><span class="p">,</span>
                <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="n">op</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

        <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;src&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
            <span class="n">srid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection_srid</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_from_json</span><span class="p">(</span><span class="n">js</span><span class="p">,</span> <span class="n">srid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Empty Result&quot;</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.count_collection_rows" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">count_collection_rows</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exact_count</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Return the number of rows in the given collection. By default, this
function returns a rough estimate within the order of magnitude of the
actual number; the exact count can also be retrieved, but this may take
much longer.
Note: in some cases, no estimate can be provided. In such cases,
-1 is returned if exact_count == False.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database the collection resides
                in [current database]</p>
              </div>
            </li>
            <li>
              <b><code>exact_count</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>If True, the actual number of rows will be
                counted. Default value: false.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[int, <span title="xcube_geodb.core.message.Message">Message</span>]</code>
              –
              <div class="doc-md-description">
                <p>the number of rows in the given collection, or -1 if exact_count</p>
              </div>
            </li>
            <li>
                  <code><span title="typing.Union">Union</span>[int, <span title="xcube_geodb.core.message.Message">Message</span>]</code>
              –
              <div class="doc-md-description">
                <p>is False and no estimate could be provided.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="xcube_geodb.core.geodb.GeoDBError">GeoDBError</span></code>
              –
              <div class="doc-md-description">
                <p>When the database raises an error</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">count_collection_rows</span><span class="p">(</span><span class="s1">&#39;my_collection&#39;</span><span class="p">],</span> <span class="n">exact_count</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">count_collection_rows</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exact_count</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Message</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the number of rows in the given collection. By default, this</span>
<span class="sd">    function returns a rough estimate within the order of magnitude of the</span>
<span class="sd">    actual number; the exact count can also be retrieved, but this may take</span>
<span class="sd">    much longer.</span>
<span class="sd">    Note: in some cases, no estimate can be provided. In such cases,</span>
<span class="sd">    -1 is returned if exact_count == False.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str):   The name of the collection</span>
<span class="sd">        database (str):     The name of the database the collection resides</span>
<span class="sd">                            in [current database]</span>
<span class="sd">        exact_count (bool): If True, the actual number of rows will be</span>
<span class="sd">                            counted. Default value: false.</span>

<span class="sd">    Returns:</span>
<span class="sd">        the number of rows in the given collection, or -1 if exact_count</span>
<span class="sd">        is False and no estimate could be provided.</span>

<span class="sd">    Raises:</span>
<span class="sd">        GeoDBError: When the database raises an error</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.count_collection_rows(&#39;my_collection&#39;], exact_count=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exact_count</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="s2">&quot;/rpc/geodb_count_collection&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="s2">&quot;/rpc/geodb_estimate_collection_count&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">}</span>
            <span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.create_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create collections from a dictionary</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Name of the collection to be created</p>
              </div>
            </li>
            <li>
              <b><code>clear</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Whether to delete existing collections</p>
              </div>
            </li>
            <li>
              <b><code>properties</code></b>
                  (<code><span title="typing.Dict">Dict</span></code>)
              –
              <div class="doc-md-description">
                <p>Property definitions for the collection</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Database to use for creating the collection</p>
              </div>
            </li>
            <li>
              <b><code>crs</code></b>
                  (<code><span title="typing.Union">Union</span>[int, str]</code>, default:
                      <code>4326</code>
)
              –
              <div class="doc-md-description">
                <p>sfdv</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>bool</code></b>(                  <code><span title="typing.Dict">Dict</span></code>
)              –
              <div class="doc-md-description">
                <p>Success</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">properties</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;[MyProp1]&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;[MyProp2]&#39;</span><span class="p">:</span> <span class="s1">&#39;date&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="s1">&#39;[MyCollection]&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">3794</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_collection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
    <span class="n">crs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4326</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">clear</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create collections from a dictionary</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): Name of the collection to be created</span>
<span class="sd">        clear (bool): Whether to delete existing collections</span>
<span class="sd">        properties (Dict): Property definitions for the collection</span>
<span class="sd">        database (str): Database to use for creating the collection</span>
<span class="sd">        crs: sfdv</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: Success</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; properties = {&#39;[MyProp1]&#39;: &#39;float&#39;, &#39;[MyProp2]&#39;: &#39;date&#39;}</span>
<span class="sd">        &gt;&gt;&gt; geodb.create_collection(collection=&#39;[MyCollection]&#39;, crs=3794, properties=properties)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">crs</span> <span class="o">=</span> <span class="n">check_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
    <span class="n">collections</span> <span class="o">=</span> <span class="p">{</span><span class="n">collection</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span><span class="p">,</span> <span class="s2">&quot;crs&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">crs</span><span class="p">)}}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_capabilities</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_collections</span><span class="p">(</span>
        <span class="n">collections</span><span class="o">=</span><span class="n">collections</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="n">clear</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.create_collection_if_not_exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_collection_if_not_exists</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Creates a collection only if the collection does not exist already.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to be created</p>
              </div>
            </li>
            <li>
              <b><code>properties</code></b>
                  (<code><span title="typing.Dict">Dict</span></code>)
              –
              <div class="doc-md-description">
                <p>Properties to be added to the collection</p>
              </div>
            </li>
            <li>
              <b><code>crs</code></b>
                  (<code>(int, str)</code>, default:
                      <code>4326</code>
)
              –
              <div class="doc-md-description">
                <p>projection</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the collection is to be created in [current database]</p>
              </div>
            </li>
            <li>
              <b><code>kwargs</code></b>
              –
              <div class="doc-md-description">
                <p>Placeholder for deprecated parameters</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>Collection</code></b>(                  <code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <span title="xcube_geodb.core.message.Message">Message</span>]</code>
)              –
              <div class="doc-md-description">
                <p>Collection info id operation succeeds</p>
              </div>
            </li>
            <li>
<b><code>None</code></b>(                  <code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <span title="xcube_geodb.core.message.Message">Message</span>]</code>
)              –
              <div class="doc-md-description">
                <p>If operation fails</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>See create_collection for an example</p>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_collection_if_not_exists</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">properties</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
    <span class="n">crs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4326</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">Message</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a collection only if the collection does not exist already.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The name of the collection to be created</span>
<span class="sd">        properties (Dict): Properties to be added to the collection</span>
<span class="sd">        crs (int, str): projection</span>
<span class="sd">        database (str): The database the collection is to be created in [current database]</span>
<span class="sd">        kwargs: Placeholder for deprecated parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        Collection:  Collection info id operation succeeds</span>
<span class="sd">        None: If operation fails</span>

<span class="sd">    Examples:</span>
<span class="sd">        See create_collection for an example</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_exists</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
                <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span>
                <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
                <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.create_collections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_collections</span><span class="p">(</span><span class="n">collections</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create collections from a dictionary
Args:
    clear (bool): Delete collections prioer to creation
    collections (Dict): A dictionalry of collections
    database (str): Database to use for creating the collection</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>bool</code></b>(                  <code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <span title="xcube_geodb.core.message.Message">Message</span>]</code>
)              –
              <div class="doc-md-description">
                <p>Success</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collections</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;[MyCollection]&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;crs&#39;</span><span class="p">:</span> <span class="mi">1234</span><span class="p">,</span> <span class="s1">&#39;properties&#39;</span><span class="p">:</span>                     <span class="p">{</span><span class="s1">&#39;[MyProp1]&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;[MyProp2]&#39;</span><span class="p">:</span> <span class="s1">&#39;date&#39;</span><span class="p">}}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">create_collections</span><span class="p">(</span><span class="n">collections</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_collections</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collections</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">clear</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">Message</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create collections from a dictionary</span>
<span class="sd">    Args:</span>
<span class="sd">        clear (bool): Delete collections prioer to creation</span>
<span class="sd">        collections (Dict): A dictionalry of collections</span>
<span class="sd">        database (str): Database to use for creating the collection</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: Success</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; collections = {&#39;[MyCollection]&#39;: {&#39;crs&#39;: 1234, &#39;properties&#39;: \</span>
<span class="sd">                {&#39;[MyProp1]&#39;: &#39;float&#39;, &#39;[MyProp2]&#39;: &#39;date&#39;}}}</span>
<span class="sd">        &gt;&gt;&gt; geodb.create_collections(collections)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;crs&quot;</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">[</span><span class="n">collection</span><span class="p">]:</span>
            <span class="n">collections</span><span class="p">[</span><span class="n">collection</span><span class="p">][</span><span class="s2">&quot;crs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">check_crs</span><span class="p">(</span>
                <span class="n">collections</span><span class="p">[</span><span class="n">collection</span><span class="p">][</span><span class="s2">&quot;crs&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drop_collection</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">GeoDBError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_capabilities</span><span class="p">()</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_exists</span><span class="p">(</span><span class="n">database</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="s2">&quot;Database does not exist.&quot;</span><span class="p">)</span>

    <span class="n">buffer</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">:</span>
        <span class="n">buffer</span><span class="p">[</span><span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="p">[</span><span class="n">collection</span><span class="p">]</span>

    <span class="n">collections</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;collections&quot;</span><span class="p">:</span> <span class="n">buffer</span><span class="p">}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_create_collections&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">collections</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">[</span><span class="s2">&quot;collections&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">CREATED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="n">collections</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.create_collections_if_not_exist" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_collections_if_not_exist</span><span class="p">(</span><span class="n">collections</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Creates collections only if collections do not exist already.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collections</code></b>
                  (<code><span title="typing.Dict">Dict</span></code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to be created</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the collection is to be created in [current database]</p>
              </div>
            </li>
            <li>
              <b><code>kwargs</code></b>
              –
              <div class="doc-md-description">
                <p>Placeholder for deprecated parameters</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Dict">Dict</span></code>
              –
              <div class="doc-md-description">
                <p>List of Collections: List of informations about created collections</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>See create_collections for examples</p>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_collections_if_not_exist</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collections</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates collections only if collections do not exist already.</span>

<span class="sd">    Args:</span>
<span class="sd">        collections (Dict): The name of the collection to be created</span>
<span class="sd">        database (str): The database the collection is to be created in [current database]</span>
<span class="sd">        kwargs: Placeholder for deprecated parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of Collections: List of informations about created collections</span>

<span class="sd">    Examples:</span>
<span class="sd">        See create_collections for examples</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">:</span>
        <span class="n">exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_exists</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exists</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="n">collection</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="p">[</span><span class="n">collection</span><span class="p">]</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_collections</span><span class="p">(</span><span class="n">collections</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.create_database" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_database</span><span class="p">(</span><span class="n">database</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create a database.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>database</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the database to be created</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>Message</code></b>(                  <code><span title="xcube_geodb.core.message.Message">Message</span></code>
)              –
              <div class="doc-md-description">
                <p>A message about the success or failure of the operation</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a database.</span>

<span class="sd">    Args:</span>
<span class="sd">        database (str): The name of the database to be created</span>

<span class="sd">    Returns:</span>
<span class="sd">        Message: A message about the success or failure of the operation</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_create_database&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="n">database</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> created&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.create_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_group</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Creates a new group with the given name, and makes the current user
admin of that group: the current user can now add or remove users to
and from the group, and all group users can publish or unpublish their
collections to or from the group. Per default, no collection is
published to the group.
This function is restricted to users with a subscription of type
'manage' (or related).</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>group_name</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Name of the group to create.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="xcube_geodb.core.message.Message">Message</span></code>
              –
              <div class="doc-md-description">
                <p>A message if the group was successfully created.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span>
<span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new group with the given name, and makes the current user</span>
<span class="sd">    admin of that group: the current user can now add or remove users to</span>
<span class="sd">    and from the group, and all group users can publish or unpublish their</span>
<span class="sd">    collections to or from the group. Per default, no collection is</span>
<span class="sd">    published to the group.</span>
<span class="sd">    This function is restricted to users with a subscription of type</span>
<span class="sd">    &#39;manage&#39; (or related).</span>

<span class="sd">    Args:</span>
<span class="sd">        group_name (str): Name of the group to create.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A message if the group was successfully created.</span>

<span class="sd">    Raises:</span>
<span class="sd">        GeoDBError if the group already exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_create_role&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="p">,</span>
        <span class="s2">&quot;user_group&quot;</span><span class="p">:</span> <span class="n">group_name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">GROUP_CREATED</span><span class="p">,</span> <span class="n">group_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created new group </span><span class="si">{</span><span class="n">group_name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.create_index" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_index</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Creates a new index on the given collection and the given property.
This may drastically speed up your queries, but adding too many
indexes on a collection might also hamper its performance. Please use
with care, and use only if you know what you are doing.</p>
<p>In case you are doing lots of geographical queries, you'll probably
want to add an index to your geometry column like this:</p>
<pre><code>&gt;&gt;&gt; geodb = GeoDBClient()
&gt;&gt;&gt; geodb.create_index(collection='[MyCollection]',
                       prop='geometry')
</code></pre>
<p>Note that you may remove your indexes using <code>remove_index</code>.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The collection's name</p>
              </div>
            </li>
            <li>
              <b><code>prop</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the property to add an index to.
        Use <code>get_collection_info</code> to get the list of
        properties for a collection.</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database the collection resides
            in [current database].</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Returns:
    A message if the index was successfully created.
Raises:
    GeoDBError if the index already exists.</p>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new index on the given collection and the given property.</span>
<span class="sd">    This may drastically speed up your queries, but adding too many</span>
<span class="sd">    indexes on a collection might also hamper its performance. Please use</span>
<span class="sd">    with care, and use only if you know what you are doing.</span>

<span class="sd">    In case you are doing lots of geographical queries, you&#39;ll probably</span>
<span class="sd">    want to add an index to your geometry column like this:</span>

<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.create_index(collection=&#39;[MyCollection]&#39;,</span>
<span class="sd">                               prop=&#39;geometry&#39;)</span>

<span class="sd">    Note that you may remove your indexes using `remove_index`.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The collection&#39;s name</span>
<span class="sd">        prop (str): The name of the property to add an index to.</span>
<span class="sd">                    Use `get_collection_info` to get the list of</span>
<span class="sd">                    properties for a collection.</span>
<span class="sd">        database (str): The name of the database the collection resides</span>
<span class="sd">                        in [current database].</span>
<span class="sd">    Returns:</span>
<span class="sd">        A message if the index was successfully created.</span>
<span class="sd">    Raises:</span>
<span class="sd">        GeoDBError if the index already exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_create_index&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
        <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="n">prop</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">INDEX_CREATED</span><span class="p">,</span> <span class="s2">&quot;table </span><span class="si">{dn}</span><span class="s2"> and property </span><span class="si">{prop}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created new index on table </span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2"> and property </span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.database_exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">database_exists</span><span class="p">(</span><span class="n">database</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Checks whether a database exists.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>database</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the database to be checked</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>bool</code></b>(                  <code>bool</code>
)              –
              <div class="doc-md-description">
                <p>database exists</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>HttpError</code>
              –
              <div class="doc-md-description">
                <p>If request fails</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">database_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks whether a database exists.</span>

<span class="sd">    Args:</span>
<span class="sd">        database (str): The name of the database to be checked</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: database exists</span>

<span class="sd">    Raises:</span>
<span class="sd">        HttpError: If request fails</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span>
            <span class="n">collection</span><span class="o">=</span><span class="s2">&quot;user_databases&quot;</span><span class="p">,</span>
            <span class="n">database</span><span class="o">=</span><span class="s2">&quot;geodb&quot;</span><span class="p">,</span>
            <span class="n">query</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;name=eq.</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.delete_from_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_from_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Delete rows from collection.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to delete rows from</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database to be checked</p>
              </div>
            </li>
            <li>
              <b><code>query</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Filter which records to delete. Follow the
         https://postgrest.org/en/v6.0/api.html query convention.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Returns:
    Message: Whether the operation has succeeded</p>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">delete_from_collection</span><span class="p">(</span><span class="s1">&#39;[MyCollection]&#39;</span><span class="p">,</span> <span class="s1">&#39;id=eq.1&#39;</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_from_collection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete rows from collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The name of the collection to delete rows from</span>
<span class="sd">        database (str): The name of the database to be checked</span>
<span class="sd">        query (str): Filter which records to delete. Follow the</span>
<span class="sd">                     https://postgrest.org/en/v6.0/api.html query convention.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Message: Whether the operation has succeeded</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.delete_from_collection(&#39;[MyCollection]&#39;, &#39;id=eq.1&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span>
            <span class="n">EventType</span><span class="o">.</span><span class="n">ROWS_DROPPED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;from collection </span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2"> where </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data from </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> deleted&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.drop_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drop_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Name of the collection to be dropped</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the colections resides in [current database]</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>bool</code></b>(                  <code><span title="xcube_geodb.core.message.Message">Message</span></code>
)              –
              <div class="doc-md-description">
                <p>Success</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">drop_collection</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="s1">&#39;[MyCollection]&#39;</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">drop_collection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): Name of the collection to be dropped</span>
<span class="sd">        database (str): The database the colections resides in [current database]</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: Success</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.drop_collection(collection=&#39;[MyCollection]&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_collections</span><span class="p">(</span>
        <span class="n">collections</span><span class="o">=</span><span class="p">[</span><span class="n">collection</span><span class="p">],</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> <span class="n">cascade</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.drop_collections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drop_collections</span><span class="p">(</span><span class="n">collections</span><span class="p">,</span> <span class="n">cascade</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the colections resides in [current database]</p>
              </div>
            </li>
            <li>
              <b><code>collections</code></b>
                  (<code><span title="typing.Sequence">Sequence</span>[str]</code>)
              –
              <div class="doc-md-description">
                <p>Collections to be dropped</p>
              </div>
            </li>
            <li>
              <b><code>cascade</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Drop in cascade mode. This can be necessary if e.g. sequences have not been
            deleted properly</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="xcube_geodb.core.message.Message">Message</span></code>
              –
              <div class="doc-md-description">
                <p>Message</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">drop_collections</span><span class="p">(</span><span class="n">collections</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;[MyCollection1]&#39;</span><span class="p">,</span> <span class="s1">&#39;[MyCollection2]&#39;</span><span class="p">])</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">drop_collections</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">collections</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">cascade</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        database (str): The database the colections resides in [current database]</span>
<span class="sd">        collections (Sequence[str]): Collections to be dropped</span>
<span class="sd">        cascade (bool): Drop in cascade mode. This can be necessary if e.g. sequences have not been</span>
<span class="sd">                        deleted properly</span>

<span class="sd">    Returns:</span>
<span class="sd">        Message</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.drop_collections(collections=[&#39;[MyCollection1]&#39;, &#39;[MyCollection2]&#39;])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_capabilities</span><span class="p">()</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">collections</span> <span class="o">=</span> <span class="p">[</span><span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span> <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">]</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;collections&quot;</span><span class="p">:</span> <span class="n">collections</span><span class="p">,</span>
        <span class="s2">&quot;cascade&quot;</span><span class="p">:</span> <span class="s2">&quot;TRUE&quot;</span> <span class="k">if</span> <span class="n">cascade</span> <span class="k">else</span> <span class="s2">&quot;FALSE&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_drop_collections&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">DROPPED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">collections</span><span class="p">)</span><span class="si">}</span><span class="s2"> deleted&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.drop_properties" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drop_properties</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Drop properties from a collection.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to delete properties
               from</p>
              </div>
            </li>
            <li>
              <b><code>properties</code></b>
                  (<code><span title="typing.List">List</span></code>)
              –
              <div class="doc-md-description">
                <p>A list containing the property names</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the collection resides in [current
               database]</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Returns:
    Message: Whether the operation succeeded</p>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">drop_properties</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="s1">&#39;MyCollection&#39;</span><span class="p">,</span>                                       <span class="n">properties</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;MyProperty1&#39;</span><span class="p">,</span>                                                   <span class="s1">&#39;MyProperty2&#39;</span><span class="p">])</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">drop_properties</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drop properties from a collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str):  The name of the collection to delete properties</span>
<span class="sd">                           from</span>
<span class="sd">        properties (List): A list containing the property names</span>
<span class="sd">        database (str):    The database the collection resides in [current</span>
<span class="sd">                           database]</span>
<span class="sd">    Returns:</span>
<span class="sd">        Message: Whether the operation succeeded</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.drop_properties(collection=&#39;MyCollection&#39;, \</span>
<span class="sd">                                  properties=[&#39;MyProperty1&#39;, \</span>
<span class="sd">                                              &#39;MyProperty2&#39;])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_capabilities</span><span class="p">()</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">collection</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_mandatory_columns</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_stored_procedure_exists</span><span class="p">(</span><span class="s2">&quot;geodb_drop_properties&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_drop_properties&quot;</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">,</span> <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span>
                <span class="n">EventType</span><span class="o">.</span><span class="n">PROPERTY_DROPPED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2"> from collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Properties </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span><span class="si">}</span><span class="s2"> dropped from &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.drop_property" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drop_property</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Drop a property from a collection.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to drop the property from</p>
              </div>
            </li>
            <li>
              <b><code>prop</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The property to delete</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the collection resides in [current database]</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>Message</code></b>(                  <code><span title="xcube_geodb.core.message.Message">Message</span></code>
)              –
              <div class="doc-md-description">
                <p>Whether the operation succeeded</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">drop_property</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="s1">&#39;[MyCollection]&#39;</span><span class="p">,</span>                                     <span class="n">prop</span><span class="o">=</span><span class="s1">&#39;[MyProperty]&#39;</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">drop_property</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drop a property from a collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The name of the collection to drop the property from</span>
<span class="sd">        prop (str): The property to delete</span>
<span class="sd">        database (str): The database the collection resides in [current database]</span>

<span class="sd">    Returns:</span>
<span class="sd">        Message: Whether the operation succeeded</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.drop_property(collection=&#39;[MyCollection]&#39;, \</span>
<span class="sd">                                prop=&#39;[MyProperty]&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_properties</span><span class="p">(</span>
        <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">[</span><span class="n">prop</span><span class="p">],</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_access_rights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_access_rights</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns the access rights on the given collection.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Dict">Dict</span></code>
              –
              <div class="doc-md-description">
                <p>The access rights on the collection of the current user and all</p>
              </div>
            </li>
            <li>
                  <code><span title="typing.Dict">Dict</span></code>
              –
              <div class="doc-md-description">
                <p>groups the user is in.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_access_rights</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the access rights on the given collection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The access rights on the collection of the current user and all</span>
<span class="sd">        groups the user is in.</span>

<span class="sd">    Raises:</span>
<span class="sd">        GeoDBError if the collection does not exist</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_get_grants&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">})</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;res&quot;</span><span class="p">])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;grantee&quot;</span><span class="p">)[</span><span class="s2">&quot;privilege_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_all_published_gs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_published_gs</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database to list collections from a database which are published via geoserver</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>, <span title="xcube_geodb.core.message.Message">Message</span>]</code>
              –
              <div class="doc-md-description">
                <p>A Dataframe of collection names</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_published_gs</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">Message</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        database (str): The database to list collections from a database which are published via geoserver</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Dataframe of collection names</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;/api/v2/services/xcube_geoserv/collections&quot;</span> <span class="k">if</span> <span class="n">database</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">js</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;collection&quot;</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Query a collection.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The collection's name.</p>
              </div>
            </li>
            <li>
              <b><code>query</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>A query. Follow the http://postgrest.org/en/v6.0/api.html query convention.</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database the collection resides in [current database].</p>
              </div>
            </li>
            <li>
              <b><code>limit</code></b>
                  (<code>int</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The maximum number of rows to be returned.</p>
              </div>
            </li>
            <li>
              <b><code>offset</code></b>
                  (<code>int</code>, default:
                      <code>0</code>
)
              –
              <div class="doc-md-description">
                <p>Offset (start) of rows to return. Used in combination with limit.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="geopandas.GeoDataFrame">GeoDataFrame</span>, <span title="pandas.DataFrame">DataFrame</span>]</code>
              –
              <div class="doc-md-description">
                <p>GeoDataFrame or DataFrame: results</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>HttpError</code>
              –
              <div class="doc-md-description">
                <p>When the database raises an error</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="s1">&#39;[MyCollection]&#39;</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;id=ge.1000&#39;</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_collection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Query a collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The collection&#39;s name.</span>
<span class="sd">        query (str): A query. Follow the http://postgrest.org/en/v6.0/api.html query convention.</span>
<span class="sd">        database (str): The name of the database the collection resides in [current database].</span>
<span class="sd">        limit (int): The maximum number of rows to be returned.</span>
<span class="sd">        offset (int): Offset (start) of rows to return. Used in combination with limit.</span>

<span class="sd">    Returns:</span>
<span class="sd">        GeoDataFrame or DataFrame: results</span>

<span class="sd">    Raises:</span>
<span class="sd">        HttpError: When the database raises an error</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.get_collection(collection=&#39;[MyCollection]&#39;, query=&#39;id=ge.1000&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">srid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection_srid</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>

    <span class="n">tab_prefix</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tab_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">actual_query</span> <span class="o">=</span> <span class="n">query</span> <span class="k">if</span> <span class="n">query</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">or</span> <span class="n">offset</span><span class="p">:</span>
            <span class="n">actual_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&amp;&quot;</span> <span class="k">if</span> <span class="n">query</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">actual_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">actual_query</span><span class="si">}</span><span class="s2">limit=</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2">&amp;offset=</span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">actual_query</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">actual_query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_from_json</span><span class="p">(</span><span class="n">js</span><span class="p">,</span> <span class="n">srid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Empty Result&quot;</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_collection_bbox" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_collection_bbox</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Retrieves the bounding box for the collection, i.e. the union of all
rows' geometries.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to return the
bounding box for.</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the collection resides in. Default:
current database.</p>
              </div>
            </li>
            <li>
              <b><code>exact</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>If the exact bbox shall be computed. Warning: This
may take much longer. Default: False.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[None, <span title="typing.Sequence">Sequence</span>]</code>
              –
              <div class="doc-md-description">
                <p>the bounding box given as tuple xmin, ymin, xmax, ymax or None if</p>
              </div>
            </li>
            <li>
                  <code><span title="typing.Union">Union</span>[None, <span title="typing.Sequence">Sequence</span>]</code>
              –
              <div class="doc-md-description">
                <p>collection is empty</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">(</span><span class="n">auth_mode</span><span class="o">=</span><span class="s1">&#39;client-credentials&#39;</span><span class="p">,</span>                                     <span class="n">client_id</span><span class="o">=</span><span class="s1">&#39;***&#39;</span><span class="p">,</span>
<span class="go">                        client_secret=&#39;***&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">get_collection_bbox</span><span class="p">(</span><span class="s1">&#39;my_collection&#39;</span><span class="p">)</span>
<span class="go">(-5, 10, 5, 11)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_collection_bbox</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exact</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the bounding box for the collection, i.e. the union of all</span>
<span class="sd">    rows&#39; geometries.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The name of the collection to return the</span>
<span class="sd">         bounding box for.</span>
<span class="sd">        database (str): The database the collection resides in. Default:</span>
<span class="sd">         current database.</span>
<span class="sd">        exact (bool): If the exact bbox shall be computed. Warning: This</span>
<span class="sd">         may take much longer. Default: False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        the bounding box given as tuple xmin, ymin, xmax, ymax or None if</span>
<span class="sd">        collection is empty</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient(auth_mode=&#39;client-credentials&#39;, \</span>
<span class="sd">                                client_id=&#39;***&#39;,</span>
<span class="sd">                                client_secret=&#39;***&#39;)</span>
<span class="sd">        &gt;&gt;&gt; geodb.get_collection_bbox(&#39;my_collection&#39;)</span>
<span class="sd">        (-5, 10, 5, 11)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">ast</span><span class="w"> </span><span class="kn">import</span> <span class="n">literal_eval</span>

        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">exact</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_get_collection_bbox&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_estimate_collection_bbox&quot;</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;BOX&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">bbox</span> <span class="o">==</span> <span class="s2">&quot;null&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">literal_eval</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_collection_by_bbox" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_collection_by_bbox</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">comparison_mode</span><span class="o">=</span><span class="s1">&#39;contains&#39;</span><span class="p">,</span> <span class="n">bbox_crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;id&gt;-1&#39;</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="s1">&#39;AND&#39;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wsg84_order</span><span class="o">=</span><span class="s1">&#39;lat_lon&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Query the database by a bounding box. Please be careful with the bbox crs. The easiest is
using the same crs as the collection. However, if the bbox crs differs from the collection,
the geoDB client will attempt to automatially transform the bbox crs according to the collection's crs.
You can also directly use the method GeoDBClient.transform_bbox_crs yourself before you pass the bbox into
this method.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to be quried</p>
              </div>
            </li>
            <li>
              <b><code>bbox</code></b>
                  (<code><span title="typing.Tuple">Tuple</span>[float, float, float, float]</code>)
              –
              <div class="doc-md-description">
                <p>minx, miny, maxx, maxy</p>
              </div>
            </li>
            <li>
              <b><code>comparison_mode</code></b>
                  (<code>str</code>, default:
                      <code>&#39;contains&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Filter mode. Can be 'contains' or 'within' ['contains']</p>
              </div>
            </li>
            <li>
              <b><code>bbox_crs</code></b>
                  (<code>(int, str)</code>, default:
                      <code>4326</code>
)
              –
              <div class="doc-md-description">
                <p>Projection code. [4326]</p>
              </div>
            </li>
            <li>
              <b><code>op</code></b>
                  (<code>str</code>, default:
                      <code>&#39;AND&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Operator for where (AND, OR) ['AND']</p>
              </div>
            </li>
            <li>
              <b><code>where</code></b>
                  (<code>str</code>, default:
                      <code>&#39;id&gt;-1&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Additional SQL where statement to further filter the collection</p>
              </div>
            </li>
            <li>
              <b><code>limit</code></b>
                  (<code>int</code>, default:
                      <code>0</code>
)
              –
              <div class="doc-md-description">
                <p>The maximum number of rows to be returned</p>
              </div>
            </li>
            <li>
              <b><code>offset</code></b>
                  (<code>int</code>, default:
                      <code>0</code>
)
              –
              <div class="doc-md-description">
                <p>Offset (start) of rows to return. Used in combination with limit.</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database the collection resides in [current database]</p>
              </div>
            </li>
            <li>
              <b><code>wsg84_order</code></b>
                  (<code>str</code>, default:
                      <code>&#39;lat_lon&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>WSG84 (EPSG:4326) is expected to be in Lat Lon format ("lat_lon"). Use "lon_lat" if</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="geopandas.GeoDataFrame">GeoDataFrame</span>, <span title="pandas.DataFrame">DataFrame</span>]</code>
              –
              <div class="doc-md-description">
                <p>A GeoPandas Dataframe</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>HttpError</code>
              –
              <div class="doc-md-description">
                <p>When the database raises an error</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">get_collection_by_bbox</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="s2">&quot;[MyCollection]&quot;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="p">(</span><span class="mf">452750.0</span><span class="p">,</span> <span class="mf">88909.549</span><span class="p">,</span> <span class="mf">464000.0</span><span class="p">,</span>                 <span class="mf">102486.299</span><span class="p">),</span> <span class="n">comparison_mode</span><span class="o">=</span><span class="s2">&quot;contains&quot;</span><span class="p">,</span> <span class="n">bbox_crs</span><span class="o">=</span><span class="mi">3794</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@deprecated_kwarg</span><span class="p">(</span><span class="s2">&quot;namespace&quot;</span><span class="p">,</span> <span class="s2">&quot;database&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_collection_by_bbox</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">bbox</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">comparison_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contains&quot;</span><span class="p">,</span>
    <span class="n">bbox_crs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4326</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;id&gt;-1&quot;</span><span class="p">,</span>
    <span class="n">op</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;AND&quot;</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">wsg84_order</span><span class="o">=</span><span class="s2">&quot;lat_lon&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Query the database by a bounding box. Please be careful with the bbox crs. The easiest is</span>
<span class="sd">    using the same crs as the collection. However, if the bbox crs differs from the collection,</span>
<span class="sd">    the geoDB client will attempt to automatially transform the bbox crs according to the collection&#39;s crs.</span>
<span class="sd">    You can also directly use the method GeoDBClient.transform_bbox_crs yourself before you pass the bbox into</span>
<span class="sd">    this method.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The name of the collection to be quried</span>
<span class="sd">        bbox (Tuple[float, float, float, float]): minx, miny, maxx, maxy</span>
<span class="sd">        comparison_mode (str): Filter mode. Can be &#39;contains&#39; or &#39;within&#39; [&#39;contains&#39;]</span>
<span class="sd">        bbox_crs (int, str): Projection code. [4326]</span>
<span class="sd">        op (str): Operator for where (AND, OR) [&#39;AND&#39;]</span>
<span class="sd">        where (str): Additional SQL where statement to further filter the collection</span>
<span class="sd">        limit (int): The maximum number of rows to be returned</span>
<span class="sd">        offset (int): Offset (start) of rows to return. Used in combination with limit.</span>
<span class="sd">        database (str): The name of the database the collection resides in [current database]</span>
<span class="sd">        wsg84_order (str): WSG84 (EPSG:4326) is expected to be in Lat Lon format (&quot;lat_lon&quot;). Use &quot;lon_lat&quot; if</span>
<span class="sd">        Lon Lat is used.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A GeoPandas Dataframe</span>

<span class="sd">    Raises:</span>
<span class="sd">        HttpError: When the database raises an error</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.get_collection_by_bbox(table=&quot;[MyCollection]&quot;, bbox=(452750.0, 88909.549, 464000.0, \</span>
<span class="sd">            102486.299), comparison_mode=&quot;contains&quot;, bbox_crs=3794, limit=10, offset=10)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bbox_crs</span> <span class="o">=</span> <span class="n">check_crs</span><span class="p">(</span><span class="n">bbox_crs</span><span class="p">)</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_collection_exists</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_stored_procedure_exists</span><span class="p">(</span><span class="s2">&quot;geodb_get_by_bbox&quot;</span><span class="p">)</span>

    <span class="n">coll_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection_srid</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">coll_crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">coll_crs</span> <span class="o">!=</span> <span class="n">bbox_crs</span><span class="p">:</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_bbox_crs</span><span class="p">(</span>
                <span class="n">bbox</span><span class="p">,</span> <span class="n">bbox_crs</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">coll_crs</span><span class="p">),</span> <span class="n">wsg84_order</span><span class="o">=</span><span class="n">wsg84_order</span>
            <span class="p">)</span>
            <span class="n">bbox_crs</span> <span class="o">=</span> <span class="n">coll_crs</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/vnd.pgrst.object+json&quot;</span><span class="p">}</span>

        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
            <span class="s2">&quot;/rpc/geodb_get_by_bbox&quot;</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
                <span class="s2">&quot;minx&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;miny&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;maxx&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="s2">&quot;maxy&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                <span class="s2">&quot;comparison_mode&quot;</span><span class="p">:</span> <span class="n">comparison_mode</span><span class="p">,</span>
                <span class="s2">&quot;bbox_crs&quot;</span><span class="p">:</span> <span class="n">bbox_crs</span><span class="p">,</span>
                <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="s2">&quot;where&quot;</span><span class="p">:</span> <span class="n">where</span><span class="p">,</span>
                <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="n">op</span><span class="p">,</span>
                <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

        <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;src&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
            <span class="n">srid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection_srid</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_from_json</span><span class="p">(</span><span class="n">js</span><span class="p">,</span> <span class="n">srid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Empty Result&quot;</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_collection_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_collection_info</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to inspect</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the collection resides in [current</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Dict">Dict</span></code>
              –
              <div class="doc-md-description">
                <p>A dictionary with collection information</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="xcube_geodb.core.geodb.GeoDBError">GeoDBError</span></code>
              –
              <div class="doc-md-description">
                <p>When the collection does not exist</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">(</span><span class="n">auth_mode</span><span class="o">=</span><span class="s1">&#39;client-credentials&#39;</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="s1">&#39;***&#39;</span><span class="p">,</span> <span class="n">client_secret</span><span class="o">=</span><span class="s1">&#39;***&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">get_collection_info</span><span class="p">(</span><span class="s1">&#39;my_collection&#39;</span><span class="p">)</span>
<span class="go">{</span>
<span class="go">    &#39;required&#39;: [&#39;id&#39;, &#39;geometry&#39;],</span>
<span class="go">    &#39;properties&#39;: {</span>
<span class="go">    &#39;id&#39;: {</span>
<span class="go">        &#39;format&#39;: &#39;integer&#39;, &#39;type&#39;: &#39;integer&#39;,</span>
<span class="go">        &#39;description&#39;: &#39;Note:This is a Primary Key.&#39;</span>
<span class="go">    },</span>
<span class="go">    &#39;created_at&#39;: {&#39;format&#39;: &#39;timestamp with time zone&#39;, &#39;type&#39;: &#39;string&#39;},</span>
<span class="go">    &#39;modified_at&#39;: {&#39;format&#39;: &#39;timestamp with time zone&#39;, &#39;type&#39;: &#39;string&#39;},</span>
<span class="go">    &#39;geometry&#39;: {&#39;format&#39;: &#39;public.geometry(Geometry,3794)&#39;, &#39;type&#39;: &#39;string&#39;},</span>
<span class="go">    &#39;my_property1&#39;: {&#39;format&#39;: &#39;double precision&#39;, &#39;type&#39;: &#39;number&#39;},</span>
<span class="go">    &#39;my_property2&#39;: {&#39;format&#39;: &#39;double precision&#39;, &#39;type&#39;: &#39;number&#39;},</span>
<span class="go">    &#39;type&#39;: &#39;object&#39;</span>
<span class="go">}</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_collection_info</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The name of the collection to inspect</span>
<span class="sd">        database (str): The database the collection resides in [current</span>
<span class="sd">        database]</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary with collection information</span>

<span class="sd">    Raises:</span>
<span class="sd">        GeoDBError: When the collection does not exist</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient(auth_mode=&#39;client-credentials&#39;, client_id=&#39;***&#39;, client_secret=&#39;***&#39;)</span>
<span class="sd">        &gt;&gt;&gt; geodb.get_collection_info(&#39;my_collection&#39;)</span>
<span class="sd">        {</span>
<span class="sd">            &#39;required&#39;: [&#39;id&#39;, &#39;geometry&#39;],</span>
<span class="sd">            &#39;properties&#39;: {</span>
<span class="sd">            &#39;id&#39;: {</span>
<span class="sd">                &#39;format&#39;: &#39;integer&#39;, &#39;type&#39;: &#39;integer&#39;,</span>
<span class="sd">                &#39;description&#39;: &#39;Note:This is a Primary Key.&#39;</span>
<span class="sd">            },</span>
<span class="sd">            &#39;created_at&#39;: {&#39;format&#39;: &#39;timestamp with time zone&#39;, &#39;type&#39;: &#39;string&#39;},</span>
<span class="sd">            &#39;modified_at&#39;: {&#39;format&#39;: &#39;timestamp with time zone&#39;, &#39;type&#39;: &#39;string&#39;},</span>
<span class="sd">            &#39;geometry&#39;: {&#39;format&#39;: &#39;public.geometry(Geometry,3794)&#39;, &#39;type&#39;: &#39;string&#39;},</span>
<span class="sd">            &#39;my_property1&#39;: {&#39;format&#39;: &#39;double precision&#39;, &#39;type&#39;: &#39;number&#39;},</span>
<span class="sd">            &#39;my_property2&#39;: {&#39;format&#39;: &#39;double precision&#39;, &#39;type&#39;: &#39;number&#39;},</span>
<span class="sd">            &#39;type&#39;: &#39;object&#39;</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">capabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

    <span class="n">collection</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

    <span class="k">if</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">capabilities</span><span class="p">[</span><span class="s2">&quot;definitions&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">capabilities</span><span class="p">[</span><span class="s2">&quot;definitions&quot;</span><span class="p">][</span><span class="n">collection</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">GeoDBError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_collection_pg" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_collection_pg</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to query</p>
              </div>
            </li>
            <li>
              <b><code>select</code></b>
                  (<code>str</code>, default:
                      <code>&#39;*&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Properties (columns) to return. Can contain aggregation functions</p>
              </div>
            </li>
            <li>
              <b><code>where</code></b>
                  (<code><span title="typing.Optional">Optional</span>[str]</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>SQL WHERE statement</p>
              </div>
            </li>
            <li>
              <b><code>group</code></b>
                  (<code><span title="typing.Optional">Optional</span>[str]</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>SQL GROUP statement</p>
              </div>
            </li>
            <li>
              <b><code>order</code></b>
                  (<code><span title="typing.Optional">Optional</span>[str]</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>SQL ORDER statement</p>
              </div>
            </li>
            <li>
              <b><code>limit</code></b>
                  (<code><span title="typing.Optional">Optional</span>[int]</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Limit for paging</p>
              </div>
            </li>
            <li>
              <b><code>offset</code></b>
                  (<code><span title="typing.Optional">Optional</span>[int]</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Offset (start) of rows to return. Used in combination with limit.</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database the collection resides in [current database]</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="geopandas.GeoDataFrame">GeoDataFrame</span>, <span title="pandas.DataFrame">DataFrame</span>]</code>
              –
              <div class="doc-md-description">
                <p>GeoDataFrame or DataFrame: results</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>HttpError</code>
              –
              <div class="doc-md-description">
                <p>When the database raises an error</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">geodb</span><span class="o">.</span><span class="n">get_collection_pg</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="s1">&#39;[MyCollection]&#39;</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;raba_id=1410&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;d_od&#39;</span><span class="p">,</span>                 <span class="n">select</span><span class="o">=</span><span class="s1">&#39;COUNT(d_od) as ct, d_od&#39;</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_collection_pg</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">select</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
    <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">group</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">offset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The name of the collection to query</span>
<span class="sd">        select (str): Properties (columns) to return. Can contain aggregation functions</span>
<span class="sd">        where (Optional[str]): SQL WHERE statement</span>
<span class="sd">        group (Optional[str]): SQL GROUP statement</span>
<span class="sd">        order (Optional[str]): SQL ORDER statement</span>
<span class="sd">        limit (Optional[int]): Limit for paging</span>
<span class="sd">        offset (Optional[int]): Offset (start) of rows to return. Used in combination with limit.</span>
<span class="sd">        database (str): The name of the database the collection resides in [current database]</span>

<span class="sd">    Returns:</span>
<span class="sd">        GeoDataFrame or DataFrame: results</span>

<span class="sd">    Raises:</span>
<span class="sd">        HttpError: When the database raises an error</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; df = geodb.get_collection_pg(collection=&#39;[MyCollection]&#39;, where=&#39;raba_id=1410&#39;, group=&#39;d_od&#39;, \</span>
<span class="sd">            select=&#39;COUNT(d_od) as ct, d_od&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tab_prefix</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tab_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_collection_exists</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_stored_procedure_exists</span><span class="p">(</span><span class="s2">&quot;geodb_get_pg&quot;</span><span class="p">)</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/vnd.pgrst.object+json&quot;</span><span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
            <span class="s2">&quot;/rpc/geodb_get_pg&quot;</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;select&quot;</span><span class="p">:</span> <span class="n">select</span><span class="p">,</span>
                <span class="s2">&quot;where&quot;</span><span class="p">:</span> <span class="n">where</span><span class="p">,</span>
                <span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
                <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="n">order</span><span class="p">,</span>
                <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;src&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
            <span class="n">srid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection_srid</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_from_json</span><span class="p">(</span><span class="n">js</span><span class="p">,</span> <span class="n">srid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Empty Result&quot;</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_collection_srid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_collection_srid</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the SRID of a collection.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The collection's name</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database the collection resides in [current database]</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[str, type(None), <span title="xcube_geodb.core.message.Message">Message</span>]]</code>
              –
              <div class="doc-md-description">
                <p>The name of the SRID</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_collection_srid</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="n">Message</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the SRID of a collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The collection&#39;s name</span>
<span class="sd">        database (str): The name of the database the collection resides in [current database]</span>

<span class="sd">    Returns:</span>
<span class="sd">        The name of the SRID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tab_prefix</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tab_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_get_collection_srid&quot;</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">},</span>
            <span class="n">raise_for_status</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;src&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">js</span><span class="p">[</span><span class="s2">&quot;srid&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_event_log" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_event_log</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the collection for which to get
                    the event log; if None, all collections are
                    returned</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database of the collection</p>
              </div>
            </li>
            <li>
              <b><code>event_type</code></b>
                  (<code><span title="xcube_geodb.core.geodb.EventType">EventType</span></code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The type of the events for which to get
                    the event log; if None, all events are
                    returned</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
              –
              <div class="doc-md-description">
                <p>Whether the stored procedure exists</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2932</span>
<span class="normal">2933</span>
<span class="normal">2934</span>
<span class="normal">2935</span>
<span class="normal">2936</span>
<span class="normal">2937</span>
<span class="normal">2938</span>
<span class="normal">2939</span>
<span class="normal">2940</span>
<span class="normal">2941</span>
<span class="normal">2942</span>
<span class="normal">2943</span>
<span class="normal">2944</span>
<span class="normal">2945</span>
<span class="normal">2946</span>
<span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span>
<span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_event_log</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">event_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EventType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        collection (str):       The name of the collection for which to get</span>
<span class="sd">                                the event log; if None, all collections are</span>
<span class="sd">                                returned</span>
<span class="sd">        database (str):         The database of the collection</span>
<span class="sd">        event_type (EventType): The type of the events for which to get</span>
<span class="sd">                                the event log; if None, all events are</span>
<span class="sd">                                returned</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the stored procedure exists</span>

<span class="sd">    Raises:</span>
<span class="sd">        GeoDBError if the stored procedure does not exist</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/get_geodb_eventlog&quot;</span>
    <span class="k">if</span> <span class="n">event_type</span> <span class="ow">or</span> <span class="n">collection</span> <span class="ow">or</span> <span class="n">database</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">?&quot;</span>
    <span class="k">if</span> <span class="n">event_type</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">event_type=</span><span class="si">{</span><span class="n">event_type</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">collection</span> <span class="ow">or</span> <span class="n">database</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span> <span class="ow">or</span> <span class="s2">&quot;%&quot;</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&amp;collection=</span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_geometry_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_geometry_types</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Retrieves the geometry types of the given collection, either as an
extensive list of the geometry types for each collection entry, or
as aggregated list of the types that appear in the collection.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The collection to list geometry types for</p>
              </div>
            </li>
            <li>
              <b><code>aggregate</code></b>
                  (<code>bool</code>, default:
                      <code>True</code>
)
              –
              <div class="doc-md-description">
                <p>If the result shall be an aggregated list, default is set to "True"</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database that contains the collection</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Returns:
    List[str]: A list of the geometry types, either for each
               collection entry or aggregated.
Raises:
    GeoDBError: If the database raises an error</p>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_geometry_types</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">aggregate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the geometry types of the given collection, either as an</span>
<span class="sd">    extensive list of the geometry types for each collection entry, or</span>
<span class="sd">    as aggregated list of the types that appear in the collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str):  The collection to list geometry types for</span>
<span class="sd">        aggregate (bool):  If the result shall be an aggregated list, default is set to &quot;True&quot;</span>
<span class="sd">        database (str):    The database that contains the collection</span>
<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of the geometry types, either for each</span>
<span class="sd">                   collection entry or aggregated.</span>
<span class="sd">    Raises:</span>
<span class="sd">        GeoDBError: If the database raises an error</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span> <span class="s2">&quot;aggregate&quot;</span><span class="p">:</span> <span class="s2">&quot;TRUE&quot;</span> <span class="k">if</span> <span class="n">aggregate</span> <span class="k">else</span> <span class="s2">&quot;FALSE&quot;</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_geometry_types&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">types</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;types&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;geometrytype&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">types</span><span class="p">]</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_group_users" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_group_users</span><span class="p">(</span><span class="n">group</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns the users that are member of the given group.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span></code>
              –
              <div class="doc-md-description">
                <p>the users that are member of the given group.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_group_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the users that are member of the given group.</span>

<span class="sd">    Returns:</span>
<span class="sd">        the users that are member of the given group.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_get_group_users&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;group_name&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">})</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;res&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">name</span><span class="p">[</span><span class="s2">&quot;rolname&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_my_collections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_my_collections</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database to list collections from</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Sequence">Sequence</span></code>
              –
              <div class="doc-md-description">
                <p>A Dataframe of collection names</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">(</span><span class="n">auth_mode</span><span class="o">=</span><span class="s1">&#39;client-credentials&#39;</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="s1">&#39;***&#39;</span><span class="p">,</span> <span class="n">client_secret</span><span class="o">=</span><span class="s1">&#39;***&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">get_my_collections</span><span class="p">()</span>
<span class="go">    owner                           database                            collection</span>
<span class="go">0   geodb_9bfgsdfg-453f-445b-a459   geodb_9bfgsdfg-453f-445b-a459   land_use</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_my_collections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        database (str): The database to list collections from</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Dataframe of collection names</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient(auth_mode=&#39;client-credentials&#39;, client_id=&#39;***&#39;, client_secret=&#39;***&#39;)</span>
<span class="sd">        &gt;&gt;&gt; geodb.get_my_collections()</span>
<span class="sd">            owner	                        database	                    collection</span>
<span class="sd">        0	geodb_9bfgsdfg-453f-445b-a459	geodb_9bfgsdfg-453f-445b-a459	land_use</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="n">database</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_get_my_collections&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;src&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_from_json</span><span class="p">(</span><span class="n">js</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;collection&quot;</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_my_databases" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_my_databases</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get a list of databases the current user owns.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>DataFrame</code></b>(                  <code><span title="pandas.DataFrame">DataFrame</span></code>
)              –
              <div class="doc-md-description">
                <p>A list of databases the user owns</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_my_databases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a list of databases the current user owns.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A list of databases the user owns</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span>
            <span class="n">collection</span><span class="o">=</span><span class="s2">&quot;user_databases&quot;</span><span class="p">,</span>
            <span class="n">database</span><span class="o">=</span><span class="s2">&quot;geodb&quot;</span><span class="p">,</span>
            <span class="n">query</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;owner=eq.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_my_groups" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_my_groups</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns the different group memberships of the current user.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              –
              <div class="doc-md-description">
                <p>The different group memberships of the current user.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_my_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the different group memberships of the current user.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The different group memberships of the current user.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_get_user_roles&quot;</span>
    <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="p">})</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span>
        <span class="s2">&quot;src&quot;</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="s2">&quot;rolname&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">[</span><span class="s2">&quot;rolname&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="p">]</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_my_usage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_my_usage</span><span class="p">(</span><span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get my geoDB data usage.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>pretty</code></b>
                  (<code>bool</code>, default:
                      <code>True</code>
)
              –
              <div class="doc-md-description">
                <p>Whether to return in human readable form or in bytes</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <span title="xcube_geodb.core.message.Message">Message</span>]</code>
              –
              <div class="doc-md-description">
                <p>A dict containing the usage in bytes (int) or as a human readable string</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>geodb = GeoDBClient()
geodb.get_my_usage(True)
{'usage': '6432 kB'}</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_my_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">Message</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get my geoDB data usage.</span>

<span class="sd">    Args:</span>
<span class="sd">        pretty (bool): Whether to return in human readable form or in bytes</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dict containing the usage in bytes (int) or as a human readable string</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.get_my_usage(True)</span>
<span class="sd">        {&#39;usage&#39;: &#39;6432 kB&#39;}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pretty&quot;</span><span class="p">:</span> <span class="n">pretty</span><span class="p">}</span> <span class="k">if</span> <span class="n">pretty</span> <span class="k">else</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_get_my_usage&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;src&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_properties" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_properties</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get a list of properties of a collection.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to retrieve a list of properties from</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the collection resides in [current database]</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>DataFrame</code></b>(                  <code><span title="pandas.DataFrame">DataFrame</span></code>
)              –
              <div class="doc-md-description">
                <p>A list of properties</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@deprecated_kwarg</span><span class="p">(</span><span class="s2">&quot;namespace&quot;</span><span class="p">,</span> <span class="s2">&quot;database&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_properties</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a list of properties of a collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The name of the collection to retrieve a list of properties from</span>
<span class="sd">        database (str): The database the collection resides in [current database]</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A list of properties</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">collection</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_get_properties&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;src&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_from_json</span><span class="p">(</span><span class="n">js</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;collection&quot;</span><span class="p">,</span> <span class="s2">&quot;column_name&quot;</span><span class="p">,</span> <span class="s2">&quot;data_type&quot;</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.get_published_gs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_published_gs</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database to list collections from a database which are published via geoserver</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Sequence">Sequence</span>, <span title="xcube_geodb.core.message.Message">Message</span>]</code>
              –
              <div class="doc-md-description">
                <p>A Dataframe of collection names</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">(</span><span class="n">auth_mode</span><span class="o">=</span><span class="s1">&#39;client-credentials&#39;</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="s1">&#39;***&#39;</span><span class="p">,</span> <span class="n">client_secret</span><span class="o">=</span><span class="s1">&#39;***&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">get_published_gs</span><span class="p">()</span>
<span class="go">    owner                           database                            collection</span>
<span class="go">0   geodb_9bfgsdfg-453f-445b-a459   geodb_9bfgsdfg-453f-445b-a459   land_use</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_published_gs</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">Message</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        database (str): The database to list collections from a database which are published via geoserver</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Dataframe of collection names</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient(auth_mode=&#39;client-credentials&#39;, client_id=&#39;***&#39;, client_secret=&#39;***&#39;)</span>
<span class="sd">        &gt;&gt;&gt; geodb.get_published_gs()</span>
<span class="sd">            owner	                        database	                    collection</span>
<span class="sd">        0	geodb_9bfgsdfg-453f-445b-a459	geodb_9bfgsdfg-453f-445b-a459	land_use</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_winchester_gs</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/geodb_geoserver/</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">/collections&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/api/v2/services/xcube_geoserv/databases/</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">/collections&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">js</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">js</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;collection&quot;</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.grant_access_to_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">grant_access_to_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">usr</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Collection name to grant access to</p>
              </div>
            </li>
            <li>
              <b><code>usr</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Username to grant access to</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the collection resides in</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>bool</code></b>(                  <code><span title="xcube_geodb.core.message.Message">Message</span></code>
)              –
              <div class="doc-md-description">
                <p>Success</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>HttpError</code>
              –
              <div class="doc-md-description">
                <p>when http request fails</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">grant_access_to_collection</span><span class="p">(</span><span class="s1">&#39;[Collection]&#39;</span><span class="p">,</span> <span class="s1">&#39;[User who gets access]&#39;</span><span class="p">)</span>
<span class="go">Access granted on Collection to User who gets access}</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span>
<span class="normal">994</span>
<span class="normal">995</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">grant_access_to_collection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">usr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): Collection name to grant access to</span>
<span class="sd">        usr (str): Username to grant access to</span>
<span class="sd">        database (str): The database the collection resides in</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: Success</span>

<span class="sd">    Raises:</span>
<span class="sd">        HttpError: when http request fails</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.grant_access_to_collection(&#39;[Collection]&#39;, &#39;[User who gets access]&#39;)</span>
<span class="sd">        Access granted on Collection to User who gets access}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_grant_access_to_collection&quot;</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span> <span class="s2">&quot;usr&quot;</span><span class="p">:</span> <span class="n">usr</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access granted on </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">usr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.head_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">head_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">num_lines</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the first num_lines of a collection.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The collection's name</p>
              </div>
            </li>
            <li>
              <b><code>num_lines</code></b>
                  (<code>int</code>, default:
                      <code>10</code>
)
              –
              <div class="doc-md-description">
                <p>The number of line to return</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database the collection resides in [current database]</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Union">Union</span>[<span title="geopandas.GeoDataFrame">GeoDataFrame</span>, <span title="pandas.DataFrame">DataFrame</span>]</code>
              –
              <div class="doc-md-description">
                <p>GeoDataFrame or DataFrame: results</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>HttpError</code>
              –
              <div class="doc-md-description">
                <p>When the database raises an error</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">head_collection</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="s1">&#39;[MyCollection]&#39;</span><span class="p">,</span> <span class="n">num_lines</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">head_collection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">num_lines</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the first num_lines of a collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The collection&#39;s name</span>
<span class="sd">        num_lines (int): The number of line to return</span>
<span class="sd">        database (str): The name of the database the collection resides in [current database]</span>

<span class="sd">    Returns:</span>
<span class="sd">        GeoDataFrame or DataFrame: results</span>

<span class="sd">    Raises:</span>
<span class="sd">        HttpError: When the database raises an error</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.head_collection(collection=&#39;[MyCollection]&#39;, num_lines=10)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span>
        <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;limit=</span><span class="si">{</span><span class="n">num_lines</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.insert_into_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">insert_into_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">upsert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_transfer_chunk_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Insert data into a collection.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Collection to be inserted to</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database the collection resides in
            [current database]</p>
              </div>
            </li>
            <li>
              <b><code>values</code></b>
                  (<code><span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>Values to be inserted</p>
              </div>
            </li>
            <li>
              <b><code>upsert</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Whether the insert shall replace existing rows
           (by PK)</p>
              </div>
            </li>
            <li>
              <b><code>crs</code></b>
                  (<code>(int, str)</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>crs (in the form of an SRID) of the geometries. If
            not present, the method will attempt guessing it
            from the GeoDataFrame input. Must be in sync with
            the target collection in the GeoDatabase</p>
              </div>
            </li>
            <li>
              <b><code>max_transfer_chunk_size</code></b>
                  (<code>int</code>, default:
                      <code>1000</code>
)
              –
              <div class="doc-md-description">
                <p>Maximum number of rows per chunk to
                           be sent to the geodb.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>ValueError</code>
              –
              <div class="doc-md-description">
                <p>When crs is not given and cannot be guessed from the
        GeoDataFrame</p>
              </div>
            </li>
            <li>
                  <code><span title="xcube_geodb.core.geodb.GeoDBError">GeoDBError</span></code>
              –
              <div class="doc-md-description">
                <p>If the values are not in format Dict</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>bool</code></b>(                  <code><span title="xcube_geodb.core.message.Message">Message</span></code>
)              –
              <div class="doc-md-description">
                <p>Success</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Example:</p>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">insert_into_collection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">,</span>
    <span class="n">upsert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">crs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_transfer_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert data into a collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): Collection to be inserted to</span>
<span class="sd">        database (str): The name of the database the collection resides in</span>
<span class="sd">                        [current database]</span>
<span class="sd">        values (GeoDataFrame): Values to be inserted</span>
<span class="sd">        upsert (bool): Whether the insert shall replace existing rows</span>
<span class="sd">                       (by PK)</span>
<span class="sd">        crs (int, str): crs (in the form of an SRID) of the geometries. If</span>
<span class="sd">                        not present, the method will attempt guessing it</span>
<span class="sd">                        from the GeoDataFrame input. Must be in sync with</span>
<span class="sd">                        the target collection in the GeoDatabase</span>
<span class="sd">        max_transfer_chunk_size (int): Maximum number of rows per chunk to</span>
<span class="sd">                                       be sent to the geodb.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: When crs is not given and cannot be guessed from the</span>
<span class="sd">                    GeoDataFrame</span>
<span class="sd">        GeoDBError: If the values are not in format Dict</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: Success</span>

<span class="sd">    Example:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">srid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_collection_srid</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="p">)</span>
    <span class="n">crs</span> <span class="o">=</span> <span class="n">check_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">crs</span> <span class="ow">and</span> <span class="n">srid</span> <span class="ow">and</span> <span class="n">srid</span> <span class="o">!=</span> <span class="n">crs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;crs </span><span class="si">{</span><span class="n">crs</span><span class="si">}</span><span class="s2"> is not compatible with collection&#39;s &quot;</span> <span class="sa">f</span><span class="s2">&quot;crs </span><span class="si">{</span><span class="n">srid</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">crs</span> <span class="o">=</span> <span class="n">crs</span> <span class="ow">or</span> <span class="n">srid</span>
    <span class="n">total_rows</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">GeoDataFrame</span><span class="p">):</span>
        <span class="c1"># headers = {&#39;Content-type&#39;: &#39;text/csv&#39;}</span>
        <span class="c1"># values = self._gdf_prepare_geom(values, crs)</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cont</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">total_rows</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">while</span> <span class="n">cont</span><span class="p">:</span>
            <span class="n">frm</span> <span class="o">=</span> <span class="n">ct</span>
            <span class="n">to</span> <span class="o">=</span> <span class="n">ct</span> <span class="o">+</span> <span class="n">max_transfer_chunk_size</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">ngdf</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">frm</span><span class="p">:</span><span class="n">to</span><span class="p">]</span>
            <span class="n">ct</span> <span class="o">+=</span> <span class="n">max_transfer_chunk_size</span>

            <span class="n">nct</span> <span class="o">=</span> <span class="n">ngdf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">cont</span> <span class="o">=</span> <span class="n">nct</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cont</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="n">nct</span> <span class="o">&lt;</span> <span class="n">max_transfer_chunk_size</span><span class="p">:</span>
                <span class="n">to</span> <span class="o">=</span> <span class="n">frm</span> <span class="o">+</span> <span class="n">nct</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing rows from </span><span class="si">{</span><span class="n">frm</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">to</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">ngdf</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">upsert</span><span class="p">:</span>
                <span class="n">ngdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>

            <span class="n">ngdf</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">ngdf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">js</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gdf_to_json</span><span class="p">(</span><span class="n">ngdf</span><span class="p">,</span> <span class="n">crs</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">upsert</span><span class="p">:</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Prefer&quot;</span><span class="p">:</span> <span class="s2">&quot;resolution=merge-duplicates&quot;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">js</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;Connection aborted&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">e</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;LineTooLong(&#39;got more than 65536 bytes &quot;</span> <span class="s2">&quot;when reading header line&#39;)&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">e</span>
                <span class="p">):</span>
                    <span class="c1"># ignore this error - the ingestion has worked.</span>
                    <span class="c1"># see https://github.com/dcs4cop/xcube-geodb/issues/60</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span>
            <span class="n">GeoDBError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Format </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="si">}</span><span class="s2"> not &quot;</span> <span class="sa">f</span><span class="s2">&quot;supported.&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_rows</span><span class="si">}</span><span class="s2"> rows inserted into &quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">ROWS_ADDED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}{</span><span class="n">dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.list_my_grants" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">list_my_grants</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>List the access grants the current user has granted.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>DataFrame</code></b>(                  <code><span title="typing.Union">Union</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="xcube_geodb.core.message.Message">Message</span>]</code>
)              –
              <div class="doc-md-description">
                <p>A list of the current user's access grants</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="xcube_geodb.core.geodb.GeoDBError">GeoDBError</span></code>
              –
              <div class="doc-md-description">
                <p>If access to geoDB fails</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_my_grants</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">Message</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List the access grants the current user has granted.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: A list of the current user&#39;s access grants</span>

<span class="sd">    Raises:</span>
<span class="sd">        GeoDBError: If access to geoDB fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_list_grants&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{})</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="s2">&quot;Body not in valid JSON format: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">js</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">js</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s2">&quot;src&quot;</span> <span class="ow">in</span> <span class="n">js</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">js</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;src&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_from_json</span><span class="p">(</span><span class="n">js</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;src&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Grants&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;No Grants&quot;</span><span class="p">]})</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">GeoDBError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.move_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">move_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">new_database</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Move a collection from one database to another.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to be moved</p>
              </div>
            </li>
            <li>
              <b><code>new_database</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The database the collection will be moved to</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the collection resides in</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">move_collection</span><span class="p">(</span><span class="s1">&#39;collection&#39;</span><span class="p">,</span> <span class="s1">&#39;new_database&#39;</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">move_collection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_database</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move a collection from one database to another.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The name of the collection to be moved</span>
<span class="sd">        new_database (str): The database the collection will be moved to</span>
<span class="sd">        database (str): The database the collection resides in</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.move_collection(&#39;collection&#39;, &#39;new_database&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span>
    <span class="n">old_dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">new_dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_rename_collection&quot;</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">old_dn</span><span class="p">,</span> <span class="s2">&quot;new_name&quot;</span><span class="p">:</span> <span class="n">new_dn</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">MOVED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">old_dn</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection moved from </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> to &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_database</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.publish_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">publish_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Publish a collection. The collection will be accessible by all users
in the geoDB.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the collection resides in
            [current database]</p>
              </div>
            </li>
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection that will be made
              public</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>Message</code></b>(                  <code><span title="xcube_geodb.core.message.Message">Message</span></code>
)              –
              <div class="doc-md-description">
                <p>Message whether operation succeeded</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">publish_collection</span><span class="p">(</span><span class="s1">&#39;[Collection]&#39;</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">publish_collection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Publish a collection. The collection will be accessible by all users</span>
<span class="sd">    in the geoDB.</span>

<span class="sd">    Args:</span>
<span class="sd">        database (str): The database the collection resides in</span>
<span class="sd">                        [current database]</span>
<span class="sd">        collection (str): The name of the collection that will be made</span>
<span class="sd">                          public</span>

<span class="sd">    Returns:</span>
<span class="sd">        Message: Message whether operation succeeded</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.publish_collection(&#39;[Collection]&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grant_access_to_collection</span><span class="p">(</span>
            <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">usr</span><span class="o">=</span><span class="s2">&quot;public&quot;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span>
            <span class="n">EventType</span><span class="o">.</span><span class="n">PUBLISHED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access granted on </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> to &quot;</span> <span class="sa">f</span><span class="s2">&quot;public.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.publish_collection_to_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">publish_collection_to_group</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Publishes the collection to the given group. Group members get read
and write access to the collection; they
cannot publish the collection to other users or groups.
This is only allowed if the current user is the owner of the
collection.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The collection's name</p>
              </div>
            </li>
            <li>
              <b><code>group</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Name of the group.</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database the collection resides</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="xcube_geodb.core.message.Message">Message</span></code>
              –
              <div class="doc-md-description">
                <p>A message if the collection was published to the group.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span>
<span class="normal">2550</span>
<span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">publish_collection_to_group</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Publishes the collection to the given group. Group members get read</span>
<span class="sd">    and write access to the collection; they</span>
<span class="sd">    cannot publish the collection to other users or groups.</span>
<span class="sd">    This is only allowed if the current user is the owner of the</span>
<span class="sd">    collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The collection&#39;s name</span>
<span class="sd">        group (str): Name of the group.</span>
<span class="sd">        database (str): The name of the database the collection resides</span>
<span class="sd">        in [current database].</span>

<span class="sd">    Returns:</span>
<span class="sd">        A message if the collection was published to the group.</span>

<span class="sd">    Raises:</span>
<span class="sd">        GeoDBError if (1) the collection does not exist, (2) the group</span>
<span class="sd">        does not exist,</span>
<span class="sd">        (3) the current user is not the owner of the collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_owner_of</span><span class="p">(</span><span class="n">dn</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="si">}</span><span class="s2"> must be owner of collection &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2"> to publish.&quot;</span>
        <span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_group_publish_collection&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
        <span class="s2">&quot;user_group&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">PUBLISHED_GROUP</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Message</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Published collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> in database &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> to group </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.publish_database_to_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">publish_database_to_group</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Publishes the database to the given group and enables group users to write into the same database.
For example, if some user A creates the database <code>someproject</code>, users that share a group G with A are
allowed to create new collections in that database (like <code>someproject_insitudata</code>) if A publishes the database
to the group G. Group users shall not, however, be allowed to read or write any existing collection in the
database; this needs extra permission by the group admin, using the already existing function
<code>publish_collection_to_group</code>.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database to publish. Default: the username.</p>
              </div>
            </li>
            <li>
              <b><code>group</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Name of the group.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span>
<span class="normal">2616</span>
<span class="normal">2617</span>
<span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span>
<span class="normal">2627</span>
<span class="normal">2628</span>
<span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span>
<span class="normal">2637</span>
<span class="normal">2638</span>
<span class="normal">2639</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">publish_database_to_group</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Publishes the database to the given group and enables group users to write into the same database.</span>
<span class="sd">    For example, if some user A creates the database `someproject`, users that share a group G with A are</span>
<span class="sd">    allowed to create new collections in that database (like `someproject_insitudata`) if A publishes the database</span>
<span class="sd">    to the group G. Group users shall not, however, be allowed to read or write any existing collection in the</span>
<span class="sd">    database; this needs extra permission by the group admin, using the already existing function</span>
<span class="sd">    `publish_collection_to_group`.</span>

<span class="sd">    Args:</span>
<span class="sd">        database (str): The name of the database to publish. Default: the username.</span>
<span class="sd">        group (str): Name of the group.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_dummy&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_owner_of</span><span class="p">(</span><span class="n">dn</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="si">}</span><span class="s2"> must be owner of database &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> to publish.&quot;</span>
        <span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_group_publish_database&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="n">database</span><span class="p">,</span>
        <span class="s2">&quot;user_group&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">PUBLISHED_DATABASE</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Published database </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> to group </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.publish_gs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">publish_gs</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Publishes collection to a BC geoservice (geoserver instance). Requires
access registration.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Name of the collection</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code><span title="typing.Optional">Optional</span>[str]</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Name of the database. Defaults to user
                    database</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              –
              <div class="doc-md-description">
                <p>Dict</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">publish_gs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Publishes collection to a BC geoservice (geoserver instance). Requires</span>
<span class="sd">    access registration.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): Name of the collection</span>
<span class="sd">        database (Optional[str]): Name of the database. Defaults to user</span>
<span class="sd">                                database</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_winchester_gs</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_put</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/geodb_geoserver/</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">/collections/&quot;</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection_id&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">},</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_put</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/api/v2/services/xcube_geoserv/databases/&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">/collections&quot;</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection_id&quot;</span><span class="p">:</span> <span class="n">collection</span><span class="p">},</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span>
            <span class="n">EventType</span><span class="o">.</span><span class="n">PUBLISHED_GS</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.refresh_auth_access_token" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">refresh_auth_access_token</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Refresh the authentication token.</p>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">refresh_auth_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Refresh the authentication token.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_auth_access_token</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.refresh_config_from_env" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">refresh_config_from_env</span><span class="p">(</span><span class="n">dotenv_file</span><span class="o">=</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">use_dotenv</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Refresh the configuration from environment variables. The variables can be preset by a dotenv file.
Args:
    dotenv_file (str): A dotenv config file
    use_dotenv (bool): Whether to use GEODB_AUTH_CLIENT_ID a dotenv file.</p>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">refresh_config_from_env</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dotenv_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.env&quot;</span><span class="p">,</span> <span class="n">use_dotenv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Refresh the configuration from environment variables. The variables can be preset by a dotenv file.</span>
<span class="sd">    Args:</span>
<span class="sd">        dotenv_file (str): A dotenv config file</span>
<span class="sd">        use_dotenv (bool): Whether to use GEODB_AUTH_CLIENT_ID a dotenv file.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">use_dotenv</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dotenv_file</span> <span class="o">=</span> <span class="n">find_dotenv</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">dotenv_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dotenv_file</span><span class="p">:</span>
            <span class="n">load_dotenv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dotenv_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_set_from_env</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.remove_index" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_index</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Removes the index on the given collection and the given property.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The collection's name</p>
              </div>
            </li>
            <li>
              <b><code>prop</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the property to add an index to.</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database the collection resides
            in [current database].</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Returns:
    A message if the index was successfully removed.</p>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">prop</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes the index on the given collection and the given property.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The collection&#39;s name</span>
<span class="sd">        prop (str): The name of the property to add an index to.</span>
<span class="sd">        database (str): The name of the database the collection resides</span>
<span class="sd">                        in [current database].</span>
<span class="sd">    Returns:</span>
<span class="sd">        A message if the index was successfully removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_drop_index&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
        <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="n">prop</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">INDEX_DROPPED</span><span class="p">,</span> <span class="s2">&quot;table </span><span class="si">{dn}</span><span class="s2"> and property </span><span class="si">{prop}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed index from table </span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2"> and property </span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.remove_user_from_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_user_from_group</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Removes the user from the given group.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>user</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Name of the user.</p>
              </div>
            </li>
            <li>
              <b><code>group</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Name of the group.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="xcube_geodb.core.message.Message">Message</span></code>
              –
              <div class="doc-md-description">
                <p>A message if the user was removed from the group.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span>
<span class="normal">2501</span>
<span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_user_from_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes the user from the given group.</span>

<span class="sd">    Args:</span>
<span class="sd">        user (str): Name of the user.</span>
<span class="sd">        group (str): Name of the group.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A message if the user was removed from the group.</span>

<span class="sd">    Raises:</span>
<span class="sd">        GeoDBError if (1) the user does not exist, (2) the group does not</span>
<span class="sd">        exist, (3) the current user does not have</span>
<span class="sd">        sufficient rights to remove the user from the group.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_group_revoke&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
        <span class="s2">&quot;user_group&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">GROUP_REMOVED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed user </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.rename_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rename_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">new_name</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to be renamed</p>
              </div>
            </li>
            <li>
              <b><code>new_name</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The new name of the collection</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the collection resides in</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>HttpError</code>
              –
              <div class="doc-md-description">
                <p>When request fails</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rename_collection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The name of the collection to be renamed</span>
<span class="sd">        new_name (str):The new name of the collection</span>
<span class="sd">        database (str): The database the collection resides in</span>

<span class="sd">    Raises:</span>
<span class="sd">        HttpError: When request fails</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span>

    <span class="n">old_dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">new_dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">new_name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_rename_collection&quot;</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">old_dn</span><span class="p">,</span> <span class="s2">&quot;new_name&quot;</span><span class="p">:</span> <span class="n">new_dn</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">RENAMED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">old_dn</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collection renamed from </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.revoke_access_from_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">revoke_access_from_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">usr</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Revoke access from a collection.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Name of the collection</p>
              </div>
            </li>
            <li>
              <b><code>usr</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>User to revoke access from</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the collection resides in
            [current database]</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>Message</code></b>(                  <code><span title="xcube_geodb.core.message.Message">Message</span></code>
)              –
              <div class="doc-md-description">
                <p>Whether operation has succeeded</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">revoke_access_from_collection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">usr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Revoke access from a collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): Name of the collection</span>
<span class="sd">        usr (str): User to revoke access from</span>
<span class="sd">        database (str): The database the collection resides in</span>
<span class="sd">                        [current database]</span>

<span class="sd">    Returns:</span>
<span class="sd">        Message: Whether operation has succeeded</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_revoke_access_from_collection&quot;</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span> <span class="s2">&quot;usr&quot;</span><span class="p">:</span> <span class="n">usr</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">UNPUBLISHED</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Access revoked from public on </span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.setup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dbname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conn</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Sets up  the database. Needs DB credentials and the database user requires CREATE TABLE/FUNCTION grants.</p>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span>
<span class="normal">3001</span>
<span class="normal">3002</span>
<span class="normal">3003</span>
<span class="normal">3004</span>
<span class="normal">3005</span>
<span class="normal">3006</span>
<span class="normal">3007</span>
<span class="normal">3008</span>
<span class="normal">3009</span>
<span class="normal">3010</span>
<span class="normal">3011</span>
<span class="normal">3012</span>
<span class="normal">3013</span>
<span class="normal">3014</span>
<span class="normal">3015</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span>
    <span class="n">host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">port</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">user</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">passwd</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dbname</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">conn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up  the database. Needs DB credentials and the database user requires CREATE TABLE/FUNCTION grants.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">host</span> <span class="o">=</span> <span class="n">host</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_DB_HOST&quot;</span><span class="p">)</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">port</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_DB_PORT&quot;</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">user</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_DB_USER&quot;</span><span class="p">)</span>
    <span class="n">passwd</span> <span class="o">=</span> <span class="n">passwd</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_DB_PASSWD&quot;</span><span class="p">)</span>
    <span class="n">dbname</span> <span class="o">=</span> <span class="n">dbname</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GEODB_DB_DBNAME&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">psycopg2</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="s2">&quot;You need to install psycopg2 first to run this module.&quot;</span><span class="p">)</span>

    <span class="n">conn</span> <span class="o">=</span> <span class="n">conn</span> <span class="ow">or</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">passwd</span><span class="p">,</span> <span class="n">dbname</span><span class="o">=</span><span class="n">dbname</span>
    <span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;xcube_geodb/sql/geodb.sql&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">sql_file</span><span class="p">:</span>
        <span class="n">sql_create</span> <span class="o">=</span> <span class="n">sql_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_create</span><span class="p">)</span>

    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.show_indexes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">show_indexes</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Shows the indexes on the given collection.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The collection's name</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database the collection resides
            in [current database].</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Returns:
    A dataframe containing the list of indexes for the given
    collection.</p>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">show_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shows the indexes on the given collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The collection&#39;s name</span>
<span class="sd">        database (str): The name of the database the collection resides</span>
<span class="sd">                        in [current database].</span>
<span class="sd">    Returns:</span>
<span class="sd">        A dataframe containing the list of indexes for the given</span>
<span class="sd">        collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_show_indexes&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.transform_bbox_crs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform_bbox_crs</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">from_crs</span><span class="p">,</span> <span class="n">to_crs</span><span class="p">,</span> <span class="n">wsg84_order</span><span class="o">=</span><span class="s1">&#39;lat_lon&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>This function can be used to reproject bboxes particularly with the use of GeoDBClient.get_collection_by_bbox.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bbox</code></b>
                  (<code><span title="typing.Tuple">Tuple</span>[float, float, float, float]</code>)
              –
              <div class="doc-md-description">
                <p>Tuple[float, float, float, float]: bbox to be reprojected, given as MINX, MINY, MAXX, MAXY</p>
              </div>
            </li>
            <li>
              <b><code>from_crs</code></b>
                  (<code><span title="typing.Union">Union</span>[int, str]</code>)
              –
              <div class="doc-md-description">
                <p>Source crs e.g. 3974</p>
              </div>
            </li>
            <li>
              <b><code>to_crs</code></b>
                  (<code><span title="typing.Union">Union</span>[int, str]</code>)
              –
              <div class="doc-md-description">
                <p>Target crs e.g. 4326</p>
              </div>
            </li>
            <li>
              <b><code>wsg84_order</code></b>
                  (<code>str</code>, default:
                      <code>&#39;lat_lon&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>WSG84 (EPSG:4326) is expected to be in Lat Lon format ("lat_lon"). Use "lon_lat" if
               Lon Lat is used.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Returns:
    Tuple[float, float, float, float]: The reprojected bounding box</p>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">bbox</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="o">.</span><span class="n">transform_bbox_crs</span><span class="p">(</span><span class="n">bbox</span><span class="o">=</span><span class="p">(</span><span class="mi">450000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">470000</span><span class="p">,</span> <span class="mi">110000</span><span class="p">),</span> <span class="n">from_crs</span><span class="o">=</span><span class="mi">3794</span><span class="p">,</span> <span class="n">to_crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bbox</span>
<span class="go">(49.36588643725233, 46.012889756941775, 14.311548793848758, 9.834303086688251)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">transform_bbox_crs</span><span class="p">(</span>
    <span class="n">bbox</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">from_crs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">to_crs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">wsg84_order</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;lat_lon&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function can be used to reproject bboxes particularly with the use of GeoDBClient.get_collection_by_bbox.</span>

<span class="sd">    Args:</span>
<span class="sd">        bbox: Tuple[float, float, float, float]: bbox to be reprojected, given as MINX, MINY, MAXX, MAXY</span>
<span class="sd">        from_crs: Source crs e.g. 3974</span>
<span class="sd">        to_crs: Target crs e.g. 4326</span>
<span class="sd">        wsg84_order (str): WSG84 (EPSG:4326) is expected to be in Lat Lon format (&quot;lat_lon&quot;). Use &quot;lon_lat&quot; if</span>
<span class="sd">                           Lon Lat is used.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple[float, float, float, float]: The reprojected bounding box</span>

<span class="sd">    Examples:</span>
<span class="sd">         &gt;&gt;&gt; bbox = GeoDBClient.transform_bbox_crs(bbox=(450000, 100000, 470000, 110000), from_crs=3794, to_crs=4326)</span>
<span class="sd">         &gt;&gt;&gt; bbox</span>
<span class="sd">         (49.36588643725233, 46.012889756941775, 14.311548793848758, 9.834303086688251)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pyproj</span><span class="w"> </span><span class="kn">import</span> <span class="n">Transformer</span>

    <span class="n">from_crs</span> <span class="o">=</span> <span class="n">check_crs</span><span class="p">(</span><span class="n">from_crs</span><span class="p">)</span>
    <span class="n">to_crs</span> <span class="o">=</span> <span class="n">check_crs</span><span class="p">(</span><span class="n">to_crs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">wsg84_order</span> <span class="o">==</span> <span class="s2">&quot;lat_lon&quot;</span> <span class="ow">and</span> <span class="n">from_crs</span> <span class="o">==</span> <span class="mi">4326</span><span class="p">:</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">transformer</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EPSG:</span><span class="si">{</span><span class="n">from_crs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;EPSG:</span><span class="si">{</span><span class="n">to_crs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="n">MINX</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="n">MINY</span><span class="p">])</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="n">MAXX</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="n">MAXY</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">wsg84_order</span> <span class="o">==</span> <span class="s2">&quot;lat_lon&quot;</span> <span class="ow">and</span> <span class="n">to_crs</span> <span class="o">==</span> <span class="mi">4326</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.truncate_database" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">truncate_database</span><span class="p">(</span><span class="n">database</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Delete all tables in the given database.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>database</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the database to be created</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>Message</code></b>(                  <code><span title="xcube_geodb.core.message.Message">Message</span></code>
)              –
              <div class="doc-md-description">
                <p>A message about the success or failure of the operation</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">truncate_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete all tables in the given database.</span>

<span class="sd">    Args:</span>
<span class="sd">        database (str): The name of the database to be created</span>

<span class="sd">    Returns:</span>
<span class="sd">        Message: A message about the success or failure of the operation</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/rpc/geodb_truncate_database&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="n">database</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> truncated&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.unpublish_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unpublish_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Revoke public access to a collection. The collection will not be
accessible by all users in the geoDB.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The database the collection resides in</p>
              </div>
            </li>
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection that will be removed</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>Message</code></b>(                  <code><span title="xcube_geodb.core.message.Message">Message</span></code>
)              –
              <div class="doc-md-description">
                <p>Message whether operation succeeded</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span> <span class="o">=</span> <span class="n">GeoDBClient</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geodb</span><span class="o">.</span><span class="n">unpublish_collection</span><span class="p">(</span><span class="s1">&#39;[Collection]&#39;</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">unpublish_collection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Revoke public access to a collection. The collection will not be</span>
<span class="sd">    accessible by all users in the geoDB.</span>

<span class="sd">    Args:</span>
<span class="sd">        database (str): The database the collection resides in</span>
<span class="sd">        [current database]</span>
<span class="sd">        collection (str): The name of the collection that will be removed</span>
<span class="sd">        from public access</span>

<span class="sd">    Returns:</span>
<span class="sd">        Message: Message whether operation succeeded</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; geodb = GeoDBClient()</span>
<span class="sd">        &gt;&gt;&gt; geodb.unpublish_collection(&#39;[Collection]&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">revoke_access_from_collection</span><span class="p">(</span>
            <span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">usr</span><span class="o">=</span><span class="s2">&quot;public&quot;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.unpublish_collection_from_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unpublish_collection_from_group</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Unpublishes the collection from the given group.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The collection's name</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database the collection resides</p>
              </div>
            </li>
            <li>
              <b><code>group</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Name of the group.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="xcube_geodb.core.message.Message">Message</span></code>
              –
              <div class="doc-md-description">
                <p>A message if the collection was unpublished from the group.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span>
<span class="normal">2577</span>
<span class="normal">2578</span>
<span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span>
<span class="normal">2598</span>
<span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span>
<span class="normal">2603</span>
<span class="normal">2604</span>
<span class="normal">2605</span>
<span class="normal">2606</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">unpublish_collection_from_group</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unpublishes the collection from the given group.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The collection&#39;s name</span>
<span class="sd">        database (str): The name of the database the collection resides</span>
<span class="sd">        in [current database].</span>
<span class="sd">        group (str): Name of the group.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A message if the collection was unpublished from the group.</span>

<span class="sd">    Raises:</span>
<span class="sd">        GeoDBError if (1) the collection does not exist, (2) the group</span>
<span class="sd">        does not exist,</span>
<span class="sd">        (3) the current user is not the owner of the collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_owner_of</span><span class="p">(</span><span class="n">dn</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="si">}</span><span class="s2"> must be owner of &quot;</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2"> to unpublish.&quot;</span>
        <span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_group_unpublish_collection&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;collection&quot;</span><span class="p">:</span> <span class="n">dn</span><span class="p">,</span>
        <span class="s2">&quot;user_group&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">UNPUBLISHED_GROUP</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Message</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Unpublished collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> in database &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> from group </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.unpublish_database_from_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unpublish_database_from_group</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Unpublishes the database from the given group.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database to unpublish. Default: the username.</p>
              </div>
            </li>
            <li>
              <b><code>group</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Name of the group.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span>
<span class="normal">2647</span>
<span class="normal">2648</span>
<span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span>
<span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">unpublish_database_from_group</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unpublishes the database from the given group.</span>

<span class="sd">    Args:</span>
<span class="sd">        database (str): The name of the database to unpublish. Default: the username.</span>
<span class="sd">        group (str): Name of the group.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_dummy&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_owner_of</span><span class="p">(</span><span class="n">dn</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="si">}</span><span class="s2"> must be owner of database &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> to unpublish.&quot;</span>
        <span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/rpc/geodb_group_unpublish_database&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="n">database</span><span class="p">,</span>
        <span class="s2">&quot;user_group&quot;</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">UNPUBLISHED_DATABASE</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unpublished database </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> from group </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.unpublish_gs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unpublish_gs</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>'Unpublishes' collection from a BC geoservice (geoserver instance).
Requires access registration.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Name of the collection</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code><span title="typing.Optional">Optional</span>[str]</code>)
              –
              <div class="doc-md-description">
                <p>Name of the database. Defaults to user
                      database</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              –
              <div class="doc-md-description">
                <p>Dict</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">unpublish_gs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &#39;Unpublishes&#39; collection from a BC geoservice (geoserver instance).</span>
<span class="sd">    Requires access registration.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): Name of the collection</span>
<span class="sd">        database (Optional[str]): Name of the database. Defaults to user</span>
<span class="sd">                                  database</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_winchester_gs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/geodb_geoserver/&quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">/collections/</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/api/v2/services/xcube_geoserv/databases/&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">/collections/</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_event</span><span class="p">(</span>
            <span class="n">EventType</span><span class="o">.</span><span class="n">UNPUBLISHED_GS</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;collection </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Collection </span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> in database </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;deleted from Geoservice&quot;</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xcube_geodb.core.geodb.GeoDBClient.update_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update data in a collection by a query.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>collection</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The name of the collection to be updated</p>
              </div>
            </li>
            <li>
              <b><code>database</code></b>
                  (<code>str</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the database to be checked</p>
              </div>
            </li>
            <li>
              <b><code>values</code></b>
                  (<code><span title="typing.Dict">Dict</span></code>)
              –
              <div class="doc-md-description">
                <p>Values to update</p>
              </div>
            </li>
            <li>
              <b><code>query</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Filter which values to be updated. Follow the http://postgrest.org/en/v6.0/api.html query</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Returns:
    Message: Success</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="xcube_geodb.core.geodb.GeoDBError">GeoDBError</span></code>
              –
              <div class="doc-md-description">
                <p>if the values is not a Dict or request fails</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Example:</p>

            <details class="quote">
              <summary>Source code in <code>xcube_geodb\core\geodb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@deprecated_kwarg</span><span class="p">(</span><span class="s2">&quot;namespace&quot;</span><span class="p">,</span> <span class="s2">&quot;database&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">update_collection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update data in a collection by a query.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection (str): The name of the collection to be updated</span>
<span class="sd">        database (str): The name of the database to be checked</span>
<span class="sd">        values (Dict): Values to update</span>
<span class="sd">        query (str): Filter which values to be updated. Follow the http://postgrest.org/en/v6.0/api.html query</span>
<span class="sd">        convention.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Message: Success</span>

<span class="sd">    Raises:</span>
<span class="sd">        GeoDBError: if the values is not a Dict or request fails</span>
<span class="sd">    Example:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span> <span class="o">=</span> <span class="n">database</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="n">database</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">collection</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_for_collection_exists</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">Dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">del</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">GeoDBError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Format </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="si">}</span><span class="s2"> not supported.&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">dn</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s2"> updated&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">GeoDBError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href=".." class="btn btn-neutral float-left" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../installation/" class="btn btn-neutral float-right" title="Installation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../installation/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
